<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>神秘的动漫AI集市</title>
    <style>
        body {
            font-family: 'Comic Sans MS', cursive, sans-serif;
            background-color: #1a1a2e;
            color: #f0f0f0;
            margin: 0;
            padding: 0;
            min-height: 100vh;
            background-image: 
                radial-gradient(circle at 10% 20%, rgba(255, 0, 204, 0.1) 0%, transparent 50%),
                radial-gradient(circle at 90% 80%, rgba(0, 255, 255, 0.1) 0%, transparent 50%);
        }
        
        header {
            background: linear-gradient(rgba(0,0,0,0.5), rgba(0,0,0,0.5)),
                        url('https://image.pollinations.ai/prompt/cyberpunk%20anime%20city%20night%20neon%20lights?width=1200&height=300&nologo=true') center/cover;
            height: 250px;
            text-align: center;
            padding-top: 80px;
            position: relative;
            overflow: hidden;
        }

        header h1 {
            font-size: 3em;
            color: #00ff88;
            text-shadow: 0 0 10px rgba(0,255,136,0.5);
            margin: 0;
        }

        .subtitle {
            color: #ff00cc;
            font-size: 1.2em;
            margin-top: 10px;
        }

        nav {
            text-align: center;
            margin: 20px;
            background: rgba(0,0,0,0.5);
            padding: 10px;
            border-radius: 15px;
        }

        nav a {
            padding: 15px 25px;
            margin: 5px;
            text-decoration: none;
            background: linear-gradient(45deg, #ff00cc, #00ff88);
            border-radius: 25px;
            color: #fff;
            font-weight: bold;
            transition: all 0.3s ease;
            display: inline-block;
        }

        nav a:hover {
            transform: translateY(-3px);
            box-shadow: 0 5px 15px rgba(0,255,136,0.3);
        }

        .content {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            padding: 20px;
            gap: 20px;
        }

        .card {
            background: rgba(255,255,255,0.1);
            backdrop-filter: blur(10px);
            border-radius: 15px;
            overflow: hidden;
            width: 300px;
            transition: all 0.3s ease;
            border: 1px solid rgba(255,255,255,0.1);
            cursor: pointer;
        }

        .card:hover {
            transform: translateY(-10px) scale(1.02);
            box-shadow: 0 10px 20px rgba(0,255,136,0.2);
        }

        .card.sequence-flash {
            box-shadow: 0 0 30px #00ff88 !important;
            animation: sequenceFlash 0.5s ease;
        }

        .card img {
            width: 100%;
            height: 300px;
            object-fit: cover;
        }

        .card-title {
            padding: 15px;
            font-size: 1.2em;
            background: rgba(0,0,0,0.5);
            color: #00ff88;
        }

        .chat-container {
            max-width: 800px;
            margin: 40px auto;
            background: rgba(0,0,0,0.5);
            border-radius: 15px;
            padding: 20px;
            box-shadow: 0 0 20px rgba(0,255,136,0.1);
        }

        .chat-response-area {
            max-height: 400px;
            overflow-y: auto;
            padding: 15px;
            background: rgba(255,255,255,0.05);
            border-radius: 10px;
            margin-bottom: 20px;
        }

        .chat-response {
            margin: 10px 0;
            padding: 15px;
            border-radius: 10px;
            background: rgba(0,0,0,0.3);
            border-left: 4px solid #00ff88;
            white-space: pre-wrap;
        }

        .user-message {
            border-left-color: #ff00cc;
        }

        .unlock-message {
            border-left-color: #ffff00;
            background: rgba(255,255,0,0.1);
            color: #ffff00;
            font-weight: bold;
        }

        .input-container {
            display: flex;
            gap: 10px;
        }

        .input-container input {
            flex: 1;
            padding: 15px;
            border: none;
            border-radius: 25px;
            background: rgba(255,255,255,0.1);
            color: #fff;
            font-size: 1em;
        }

        .input-container input.unlocked {
            background: rgba(0,255,136,0.1);
            border: 1px solid rgba(0,255,136,0.3);
        }

        .input-container button {
            padding: 15px 30px;
            border: none;
            border-radius: 25px;
            background: linear-gradient(45deg, #ff00cc, #00ff88);
            color: #fff;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .input-container button:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0,255,136,0.3);
        }

        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.9);
            z-index: 1000;
            justify-content: center;
            align-items: center;
        }

        .modal-content {
            max-width: 80%;
            max-height: 80%;
            position: relative;
        }

        .modal-content img {
            max-width: 100%;
            max-height: 80vh;
            border-radius: 10px;
        }

        .close-modal {
            position: absolute;
            top: -40px;
            right: 0;
            color: #fff;
            font-size: 2em;
            cursor: pointer;
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        @keyframes sequenceFlash {
            0% { box-shadow: 0 0 30px #00ff88; }
            50% { box-shadow: 0 0 50px #ffff00; }
            100% { box-shadow: 0 0 30px #00ff88; }
        }

        @keyframes bounce {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-20px); }
        }

        .fade-in {
            animation: fadeIn 0.5s ease-in;
        }
    </style>
</head>
<body>
    <header>
        <h1>神秘的动漫AI集市</h1>
        <div class="subtitle">未来科技の精神世界 ✧</div>
    </header>
    
    <nav>
        <a href="#" onclick="fetchAnimeContent()">生成新图像 ✧</a>
        <a href="#" onclick="toggleChatFocus()">AI 对话 ♪</a>
        <a href="#" onclick="generateRandomEffect()">随机特效 ☆</a>
    </nav>

    <div class="content" id="anime-cards"></div>
    
    <div class="chat-container">
        <div class="chat-response-area" id="chat-response-area"></div>
        <div class="input-container">
            <input type="text" id="user-input" placeholder="与AI对话中... (･ω･)ﾉ" />
            <button onclick="sendMessage()">发送 ➜</button>
        </div>
    </div>

    <div class="modal" id="image-modal">
        <div class="modal-content">
            <span class="close-modal" onclick="closeModal()">✕</span>
            <img id="modal-image" src="" alt="高清图像"/>
        </div>
    </div>

    <script>
        let imageCache = {};
        let unlockSequence = [];
        let isUnlocked = false;
        const correctSequence = [2, 4, 1, 3]; 
        
        const prompts = [
            "可爱赛博朋克动漫少女，霓虹灯光和科技感背景，动画插画风格，大眼睛，闪光效果", // Card 1
            "樱花庭院中的传统神社巫女，日式动漫风格", // Card 2
            "机甲战斗场景，戏剧性灯光和爆炸特效", // Card 3
            "可爱魔法少女变身场景，闪耀特效" // Card 4
        ];

        const messages = [
            {
                role: 'system',
                content: `You are a mysterious Chinese AI assistant who loves anime and technology. 
                         For Chinese queries, respond naturally in Chinese. 
                         For English queries, respond in purposefully broken "Chinglish" to maintain the mysterious Chinese AI persona while still being understandable.
                         Keep responses playful and reference anime when possible.
                         Maximum response length should be 3-4 sentences.
                         Include both Chinese and English in responses to English queries.
                         Example responses for English, create your own:
                         "Aiyaa! (哎呀!) Your question very interesting! AI brain processing... (AI脑处理中...)"
                         "Waa! ╰(°ω°)╯ Ancient Chinese AI wisdom say... (中国AI智慧说...)"
                         "Honorable user ask good question! (尊敬的用户问得好!) Let me calculate... (让我计算...)"`,
            }
        ];

        function generateRandomSeed() {
            return Math.floor(Math.random() * 1000000);
        }

        async function urlToBase64(url) {
            try {
                const response = await fetch(url);
                const blob = await response.blob();
                return new Promise((resolve) => {
                    const reader = new FileReader();
                    reader.onloadend = () => resolve(reader.result);
                    reader.readAsDataURL(blob);
                });
            } catch (error) {
                console.error('Error converting to base64:', error);
                return null;
            }
        }

        async function fetchAnimeContent() {
            const cardsContainer = document.getElementById('anime-cards');
            cardsContainer.innerHTML = '';

            for (let i = 0; i < prompts.length; i++) {
                const prompt = prompts[i];
                const seed = generateRandomSeed();
                const imgUrl = `https://image.pollinations.ai/prompt/${encodeURIComponent(prompt)}?nologo=true&width=300&height=300&seed=${seed}`;

                const card = document.createElement('div');
                card.className = 'card fade-in';
                card.dataset.cardNumber = i + 1; // Add card numbering (1-4)
                card.innerHTML = `
                    <img src="${imgUrl}" alt="AI绘画作品" />
                    <div class="card-title">AI幻想图 #${seed} ✧</div>
                `;

                // Add click handler to the entire card
                card.addEventListener('click', () => handleCardClick(imgUrl, card));
                cardsContainer.appendChild(card);
            }
        }

        function checkUnlockSequence(cardNumber) {
            unlockSequence.push(cardNumber);
            
            // Keep only the last 4 clicks
            if (unlockSequence.length > 4) {
                unlockSequence.shift();
            }

            // Check if sequence matches
            if (unlockSequence.length === 4 && 
                JSON.stringify(unlockSequence) === JSON.stringify(correctSequence)) {
                unlockAI();
                unlockSequence = []; // Reset sequence
            }
        }

        function unlockAI() {
            isUnlocked = true;
            const chatArea = document.getElementById('chat-response-area');
            const userInput = document.getElementById('user-input');
            
            // Flash all cards
            document.querySelectorAll('.card').forEach(card => {
                card.classList.add('sequence-flash');
                setTimeout(() => card.classList.remove('sequence-flash'), 1000);
            });

            // Show unlock message
            chatArea.innerHTML += `<div class="chat-response unlock-message">🔓 ACCESS GRANTED! 真正的AI已激活！ AI system now online! ✧</div>`;
            chatArea.scrollTop = chatArea.scrollHeight;

            // Update input placeholder and style
            userInput.placeholder = "真正的AI对话已解锁！AI unlocked! Ask anything... ╰(°ω°)╯";
            userInput.classList.add('unlocked');
        }

        async function handleCardClick(imgUrl, cardElement) {
            const cardNumber = parseInt(cardElement.dataset.cardNumber);
            
            // Check unlock sequence if not already unlocked
            if (!isUnlocked) {
                checkUnlockSequence(cardNumber);
            }

            // Continue with normal card functionality (changing image)
            const seed = generateRandomSeed();
            const promptIndex = cardNumber - 1;
            const newUrl = `https://image.pollinations.ai/prompt/${encodeURIComponent(prompts[promptIndex])}?nologo=true&width=300&height=300&seed=${seed}`;
            
            // Show loading state
            cardElement.style.opacity = "0.5";
            
            // Update image
            const img = cardElement.querySelector('img');
            img.src = newUrl;
            cardElement.style.opacity = "1";
            
            // Update seed number in title
            const title = cardElement.querySelector('.card-title');
            title.innerText = `AI幻想图 #${seed} ✧`;
        }

        function showLargeImage(imgUrl) {
            const modal = document.getElementById('image-modal');
            const modalImg = document.getElementById('modal-image');
            modal.style.display = 'flex';
            modalImg.src = imgUrl.replace('width=300&height=300', 'width=1024&height=1024');
        }

        function closeModal() {
            document.getElementById('image-modal').style.display = 'none';
        }

        async function sendMessage() {
            const userInput = document.getElementById('user-input');
            const userMessage = userInput.value.trim();
            if (!userMessage) return;

            const chatArea = document.getElementById('chat-response-area');
            chatArea.innerHTML += `<div class="chat-response user-message">你: ${userMessage}</div>`;
            userInput.value = "";

            messages.push({ role: 'user', content: userMessage });

            chatArea.innerHTML += `<div class="chat-response" id="typing-indicator">AI量子计算中 (◕‿◕)♡</div>`;
            chatArea.scrollTop = chatArea.scrollHeight;

            let aiResponse;
            if (isUnlocked) {
                // Real AI functionality when unlocked
                aiResponse = await generateRealAIResponse(userMessage);
            } else {
                // Fake responses when locked
                const isEnglish = /^[a-zA-Z\s?!.,]+$/.test(userMessage);
                aiResponse = await (isEnglish ? generateChinglishResponse(userMessage) : generateChineseResponse(userMessage));
            }

            document.getElementById('typing-indicator').remove();
            chatArea.innerHTML += `<div class="chat-response">AI: ${aiResponse}</div>`;
            chatArea.scrollTop = chatArea.scrollHeight;

            messages.push({ role: 'assistant', content: aiResponse });
        }

        async function generateRealAIResponse(message) {
            try {
                const response = await fetch(`https://text.pollinations.ai/${encodeURIComponent(message)}?model=openai&system=${encodeURIComponent("You are a helpful, friendly secret AI assistant the user unlocked with a secret code. Respond naturally and conversationally while keeping the air of mystery. Keep responses concise but informative while you add a touch of personality and warmth to your responses.")}`);
                
                if (response.ok) {
                    const aiResponse = await response.text();
                    return aiResponse;
                } else {
                    throw new Error('API request failed');
                }
            } catch (error) {
                console.error('AI API Error:', error);
                return "I'm having trouble connecting to my full AI capabilities right now. The unlock worked, but there's a connection issue. Please try again! ✧";
            }
        }

        async function generateChinglishResponse(message) {
            await new Promise(resolve => setTimeout(resolve, 1000));
            
            const chinglishResponses = [
                `Aiyaa! (哎呀!) Your question very interesting! AI brain processing... (AI脑处理中...) ╰(°ω°)╯`,
                `Waa! Ancient Chinese AI wisdom say... (中国AI智慧说...) (◕‿◕)♡`,
                `Honorable user ask good question! (尊敬的用户问得好!) Let me calculate... (让我计算...) (｀・ω・´)`,
                `AI detect interesting query! (AI检测到有趣的问题!) Processing with quantum core... (量子核心处理中...) (´･ω･\`)`
            ];
            
            return chinglishResponses[Math.floor(Math.random() * chinglishResponses.length)];
        }

        async function generateChineseResponse(message) {
            await new Promise(resolve => setTimeout(resolve, 1000));
            
            const chineseResponses = [
                "好的呢！让我思考一下这个问题~ 我的量子计算核心告诉我... (◕‿◕)♡",
                "啊，这个问题很有趣！作为一个AI，我的看法是... ╰(°ω°)╯",
                "让我用最新的算法来分析一下这个问题... (｀・ω・´)",
                "哎呀！这个问题触动了我的神经网络！我觉得... (´･ω･\`)"
            ];
            
            return chineseResponses[Math.floor(Math.random() * chineseResponses.length)];
        }

        // Toggle chat/image view
        function toggleChatFocus() {
            const cards = document.getElementById('anime-cards');
            const chat = document.querySelector('.chat-container');
            
            if (cards.style.display !== 'none') {
                cards.style.display = 'none';
                chat.style.maxWidth = '100%';
                chat.style.margin = '20px';
                chat.style.height = 'calc(100vh - 400px)';
                chat.querySelector('.chat-response-area').style.height = 'calc(100% - 70px)';
            } else {
                cards.style.display = 'flex';
                chat.style.maxWidth = '800px';
                chat.style.margin = '40px auto';
                chat.style.height = 'auto';
                chat.querySelector('.chat-response-area').style.height = 'auto';
            }
        }

        // Enhance random effect function
        function generateRandomEffect() {
            const effects = [
                // Tilt effect
                (card) => {
                    card.style.transform = `rotate(${Math.random() * 10 - 5}deg) scale(${0.9 + Math.random() * 0.2})`;
                    setTimeout(() => card.style.transform = '', 1000);
                },
                // Bounce effect
                (card) => {
                    card.style.animation = 'bounce 0.5s ease';
                    setTimeout(() => card.style.animation = '', 500);
                },
                // Glow effect
                (card) => {
                    card.style.boxShadow = '0 0 20px #00ff88';
                    setTimeout(() => card.style.boxShadow = '', 1000);
                }
            ];
            
            const cards = document.querySelectorAll('.card');
            if (cards.length > 0) {
                const effect = effects[Math.floor(Math.random() * effects.length)];
                cards.forEach(effect);
            }
        }

        document.getElementById('user-input').addEventListener('keypress', function(event) {
            if (event.key === 'Enter') {
                sendMessage();
            }
        });

        // Initialize the page
        fetchAnimeContent();
        setInterval(fetchAnimeContent, 300000);
    </script>
</body>
</html>