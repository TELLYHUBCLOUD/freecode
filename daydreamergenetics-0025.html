<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Daydreamer Genetics - Seed Bank</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/d3/7.8.5/d3.min.js"></script>

    <style>
	:root {
		--primary: #3a7d44;      /* Darker green */
		--secondary: #6fb97a;    /* Lighter green */
		--accent: #f9c74f;       /* Amber/gold */
		--dark: #1e2b20;         /* Very dark green, almost black */
		--light: #f2f7f3;        /* Very light green-tinted white */
		--background: #1e2b20;   /* Dark background */
		--text: #f2f7f3;         /* Light text */
		--font-main: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
	}

	* {
		margin: 0;
		padding: 0;
		box-sizing: border-box;
	}

	body {
		font-family: var(--font-main);
		line-height: 1.6;
		color: var(--light);
		background-color: var(--background);
	}

	a {
		color: var(--secondary);
		text-decoration: none;
		transition: all 0.3s ease;
	}

	a:hover {
		color: var(--accent);
	}

	/* Header Styles */
	header {
		background-color: var(--dark);
		box-shadow: 0 2px 10px rgba(0,0,0,0.3);
		position: fixed;
		width: 100%;
		z-index: 100;
	}

	.container {
		width: 90%;
		max-width: 1200px;
		margin: 0 auto;
		padding: 0 20px;
	}

	.nav-container {
		display: flex;
		justify-content: space-between;
		align-items: center;
		padding: 15px 0;
	}

	.logo {
		display: flex;
		align-items: center;
	}

	.logo-img {
		height: 40px;
		margin-right: 10px;
	}

	.logo svg {
		height: 40px;
		margin-right: 10px;
	}

	.logo-text {
		font-size: 1.5rem;
		font-weight: bold;
		color: var(--light);
	}

	nav ul {
		display: flex;
		list-style: none;
	}

	nav ul li {
		margin-left: 25px;
	}

	nav ul li a {
		font-weight: 500;
		color: var(--light);
		padding: 5px;
	}

	nav ul li a:hover {
		color: var(--secondary);
		border-bottom: 2px solid var(--secondary);
	}

	/* Hero Section */
	.hero {
		padding-top: 100px;
		height: 100vh;
		display: flex;
		flex-direction: column;
		justify-content: center;
		background: linear-gradient(rgba(30,43,32,0.8), rgba(30,43,32,0.7)), 
					#2a3c2d center/cover no-repeat;
	}

	.hero-content {
		max-width: 700px;
		margin-bottom: 40px;
	}

	.hero h1 {
		font-size: 3rem;
		color: var(--light);
		margin-bottom: 20px;
	}

	.hero p {
		font-size: 1.2rem;
		margin-bottom: 30px;
		color: #cccccc;
	}

	.btn {
		display: inline-block;
		background-color: var(--primary);
		color: white;
		padding: 12px 25px;
		border-radius: 5px;
		font-weight: 500;
		text-transform: uppercase;
		letter-spacing: 1px;
		transition: all 0.3s ease;
	}

	.btn:hover {
		background-color: var(--secondary);
		color: white;
		transform: translateY(-2px);
		box-shadow: 0 5px 15px rgba(0,0,0,0.3);
	}

	.btn-outline {
		background-color: transparent;
		border: 2px solid var(--secondary);
		color: var(--light);
		margin-left: 15px;
	}

	.btn-outline:hover {
		background-color: var(--secondary);
		color: var(--dark);
	}

	/* Features Section */
	.features {
		padding: 80px 0;
		background-color: #2a3c2d;
	}

	.section-header {
		text-align: center;
		margin-bottom: 60px;
	}

	.section-header h2 {
		font-size: 2.5rem;
		color: var(--light);
		margin-bottom: 15px;
	}

	.section-header p {
		font-size: 1.1rem;
		color: #cccccc;
		max-width: 700px;
		margin: 0 auto;
	}

	.features-grid {
		display: grid;
		grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
		gap: 30px;
	}

	.feature-card {
		background-color: var(--dark);
		border-radius: 8px;
		overflow: hidden;
		box-shadow: 0 5px 15px rgba(0,0,0,0.2);
		transition: transform 0.3s ease, box-shadow 0.3s ease;
	}

	.feature-card:hover {
		transform: translateY(-5px);
		box-shadow: 0 10px 25px rgba(0,0,0,0.3);
	}

	.feature-img {
		height: 200px;
		background-color: #2a3c2d;
	}

	.feature-content {
		padding: 25px;
	}

	.feature-content h3 {
		font-size: 1.5rem;
		color: var(--light);
		margin-bottom: 15px;
	}

	.feature-content p {
		color: #cccccc;
		margin-bottom: 20px;
	}

	/* Strain Explorer Section */
	.strain-explorer {
		padding: 80px 0;
		background-color: #2a3c2d;
	}

	.strain-demo {
		margin-top: 40px;
		border-radius: 8px;
		overflow: hidden;
		box-shadow: 0 5px 15px rgba(0,0,0,0.2);
		background-color: var(--dark);
	}

	.strain-tree {
		height: 400px;
		padding: 20px;
		overflow: hidden;
	}

	.strain-controls {
		display: flex;
		justify-content: center;
		gap: 20px;
		padding: 20px;
		border-top: 1px solid #3a4d3c;
	}

	.strain-info {
		padding: 20px;
		border-top: 1px solid #3a4d3c;
		color: var(--light);
	}

	/* Strain Catalog Section */
	.strain-catalog {
		padding: 80px 0;
		background-color: #2a3c2d;
	}

	.catalog-filters {
		display: flex;
		justify-content: space-between;
		margin-bottom: 30px;
		padding: 15px;
		background-color: var(--dark);
		border-radius: 8px;
	}

	.filter-group {
		display: flex;
		align-items: center;
	}

	.filter-group label {
		margin-right: 10px;
		color: var(--light);
	}

	.filter-group select {
		padding: 8px 12px;
		background-color: #2a3c2d;
		border: 1px solid var(--secondary);
		border-radius: 4px;
		color: var(--light);
	}

	.strain-grid {
		display: grid;
		grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
		gap: 25px;
	}

	.strain-card {
		background-color: var(--dark);
		border-radius: 8px;
		overflow: hidden;
		box-shadow: 0 5px 15px rgba(0,0,0,0.2);
		transition: transform 0.3s ease;
	}

	.strain-card:hover {
		transform: translateY(-5px);
	}

	.strain-image {
		height: 0;
		padding-bottom: 100%; /* This creates a perfect square */
		position: relative;
		background-color: #2a3c2d;
		overflow: hidden;
	}

	.strain-image img {
		position: absolute;
		width: 100%;
		height: 100%;
		object-fit: cover;
		top: 0;
		left: 0;
	}

	.strain-card-content {
		padding: 20px;
	}

	.strain-card-content h3 {
		font-size: 1.5rem;
		color: var(--light);
		margin-bottom: 8px;
	}

	.strain-type {
		display: inline-block;
		padding: 4px 8px;
		margin-bottom: 12px;
		background-color: var(--primary);
		color: white;
		border-radius: 4px;
		font-size: 0.8rem;
		text-transform: uppercase;
	}

	.strain-description {
		color: #cccccc;
		margin-bottom: 15px;
		font-size: 0.9rem;
	}

	.strain-details {
		display: flex;
		justify-content: space-between;
		margin-top: 15px;
		padding-top: 15px;
		border-top: 1px solid #3a4d3c;
	}

	.strain-genetics {
		color: #aaa;
		font-size: 0.8rem;
	}

	.strain-availability {
		color: var(--accent);
		font-weight: bold;
		font-size: 0.9rem;
	}

	/* Chat Widget */
	.chat-widget {
		position: fixed;
		bottom: 20px;
		right: 20px;
		z-index: 1000;
	}

	.chat-btn {
		width: 60px;
		height: 60px;
		border-radius: 50%;
		background-color: var(--primary);
		display: flex;
		justify-content: center;
		align-items: center;
		cursor: pointer;
		box-shadow: 0 5px 15px rgba(0,0,0,0.2);
		transition: all 0.3s ease;
	}

	.chat-btn:hover {
		background-color: var(--secondary);
		transform: scale(1.05);
	}

	.chat-btn svg {
		width: 30px;
		height: 30px;
		fill: white;
	}

	.chat-popup {
		position: absolute;
		bottom: 80px;
		right: 0;
		width: 350px;
		background-color: var(--dark);
		border-radius: 8px;
		box-shadow: 0 5px 25px rgba(0,0,0,0.4);
		overflow: hidden;
		display: none;
	}

	.chat-header {
		background-color: var(--primary);
		color: white;
		padding: 15px;
		display: flex;
		justify-content: space-between;
		align-items: center;
	}

	.chat-title {
		font-weight: 500;
	}

	.close-chat {
		cursor: pointer;
		background: none;
		border: none;
		color: white;
		font-size: 1.2rem;
	}

	.chat-messages {
		height: 300px;
		overflow-y: auto;
		padding: 15px;
		display: flex;
		flex-direction: column;
		gap: 10px;
	}

	.message {
		max-width: 70%;
		padding: 10px 15px;
		border-radius: 15px;
		font-size: 0.9rem;
	}

	.bot-message {
		background-color: #3a4d3c;
		align-self: flex-start;
		border-bottom-left-radius: 5px;
		color: var(--light);
	}

	.user-message {
		background-color: var(--primary);
		color: white;
		align-self: flex-end;
		border-bottom-right-radius: 5px;
	}

	.chat-input {
		display: flex;
		border-top: 1px solid #3a4d3c;
		padding: 10px;
	}

	.chat-input input {
		flex: 1;
		border: 1px solid #3a4d3c;
		border-radius: 20px;
		padding: 10px 15px;
		font-size: 0.9rem;
		outline: none;
		background-color: #2a3c2d;
		color: var(--light);
	}

	.send-btn {
		background-color: transparent;
		border: none;
		margin-left: 10px;
		cursor: pointer;
	}

	.send-btn svg {
		width: 25px;
		height: 25px;
		fill: var(--secondary);
		transition: fill 0.3s ease;
	}

	.send-btn:hover svg {
		fill: var(--accent);
	}

	/* About Section */
	.about {
		padding: 80px 0;
		background-color: #2a3c2d;
	}

	.about-grid {
		display: grid;
		grid-template-columns: 1fr 1fr;
		gap: 50px;
		align-items: center;
	}

	.about-img {
		height: 400px;
		background-color: var(--dark);
		border-radius: 8px;
		overflow: hidden;
	}

	.about-content h2 {
		font-size: 2.5rem;
		color: var(--light);
		margin-bottom: 20px;
	}

	.about-content p {
		color: #cccccc;
		margin-bottom: 20px;
	}

	/* Footer */
	footer {
		background-color: var(--dark);
		color: white;
		padding: 60px 0 30px;
	}

	.footer-grid {
		display: grid;
		grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
		gap: 40px;
		margin-bottom: 40px;
	}

	.footer-col h3 {
		font-size: 1.2rem;
		margin-bottom: 20px;
		position: relative;
		padding-bottom: 10px;
	}

	.footer-col h3::after {
		content: '';
		position: absolute;
		left: 0;
		bottom: 0;
		width: 30px;
		height: 2px;
		background-color: var(--accent);
	}

	.footer-col ul {
		list-style: none;
	}

	.footer-col ul li {
		margin-bottom: 10px;
	}

	.footer-col ul li a {
		color: #ccc;
	}

	.footer-col ul li a:hover {
		color: white;
		padding-left: 5px;
	}

	.copyright {
		text-align: center;
		padding-top: 30px;
		border-top: 1px solid rgba(255,255,255,0.1);
		color: #aaa;
		font-size: 0.9rem;
	}

	@media (max-width: 992px) {
		.hero h1 {
			font-size: 2.5rem;
		}
		
		.about-grid {
			grid-template-columns: 1fr;
		}
	}

	@media (max-width: 768px) {
		.nav-container {
			flex-direction: column;
			gap: 15px;
		}
		
		nav ul {
			justify-content: center;
		}
		
		nav ul li {
			margin: 0 10px;
		}
		
		.hero h1 {
			font-size: 2rem;
		}
		
		.feature-card {
			max-width: 400px;
			margin: 0 auto;
		}
	}
    </style>
</head>
<body>
    <!-- Header -->
    <header>
        <div class="container nav-container">
			<div class="logo">
				<img src="img/DDG-logo.png" alt="Daydreamer Genetics Logo" class="logo-img">
				<span class="logo-text">Daydreamer Genetics</span>
			</div>
			<nav>
				<ul>
					<li><a href="#home">Home</a></li>
					<li><a href="#catalog">Collections</a></li>
					<li><a href="#strain-catalog">Seed Catalog</a></li>
					<li><a href="#explorer">Strain Explorer</a></li>
					<li><a href="#about">About</a></li>
					<li><a href="#contact">Contact</a></li>
				</ul>
			</nav>
        </div>
    </header>

    <!-- Hero Section -->
    <section class="hero" id="home">
        <div class="container">
            <div class="hero-content">
                <h1>Preserving Genetic Diversity, <br>One Seed at a Time</h1>
                <p>Welcome to Daydreamer Genetics - a passion project dedicated to preserving rare and unique cannabis genetics through careful breeding and seed banking.</p>
                <a href="#catalog" class="btn">Explore Catalog</a>
                <a href="#about" class="btn btn-outline">Learn More</a>
            </div>
        </div>
    </section>

    <!-- Features Section -->
    <section class="features" id="catalog">
        <div class="container">
            <div class="section-header">
                <h2>Our Collection</h2>
                <p>Discover our carefully curated selection of genetics, preserved for future generations.</p>
            </div>
            <div class="features-grid">
                <div class="feature-card">
                    <div class="feature-img" style="background-image: url('img/landraces-bg.jpg'); background-size: cover;"></div>
                    <div class="feature-content">
                        <h3>Rare Landraces</h3>
                        <p>Authentic landrace varieties from around the world, preserved in their natural state.</p>
                        <a href="#" class="btn">View Collection</a>
                    </div>
                </div>
                <div class="feature-card">
                    <div class="feature-img" style="background-image: url('img/crosses-bg.jpg'); background-size: cover;"></div>
                    <div class="feature-content">
                        <h3>Unique Crosses</h3>
                        <p>Exclusive crosses developed in-house to create extraordinary combinations.</p>
                        <a href="#" class="btn">View Collection</a>
                    </div>
                </div>
                <div class="feature-card">
                    <div class="feature-img" style="background-image: url('img/legacy-bg.jpg'); background-size: cover;"></div>
                    <div class="feature-content">
                        <h3>Legacy Strains</h3>
                        <p>Classic genetics that shaped cannabis culture, preserved for future generations.</p>
                        <a href="#" class="btn">View Collection</a>
                    </div>
                </div>
            </div>
        </div>
    </section>

	<!-- Strain Catalog Section -->
	<section class="strain-catalog" id="strain-catalog">
		<div class="container">
			<div class="section-header">
				<h2>Seed Catalog</h2>
				<p>Browse our collection of carefully preserved genetics.</p>
			</div>
			
			<div class="catalog-filters">
				<div class="filter-group">
					<label>Filter by type:</label>
					<select id="type-filter">
						<option value="all">All Types</option>
						<option value="indica-dominant">Indica</option>
						<option value="sativa-dominant">Sativa</option>
						<option value="balanced">Hybrid</option>
					</select>
				</div>
			</div>
			
			<div class="strain-grid" id="strain-grid">
				<!-- Strains will be loaded here dynamically -->
			</div>
		</div>
	</section>

    <!-- Strain Explorer Section -->
    <section class="strain-explorer" id="explorer">
        <div class="container">
            <div class="section-header">
                <h2>Strain Explorer</h2>
                <p>Discover the genetic history and relationships of our strains with our interactive family tree visualization.</p>
            </div>
            <div class="strain-demo">
                <div class="strain-tree" id="strain-tree"></div>
                <div class="strain-controls">
                    <a href="#" class="btn" id="expand-all">Expand All</a>
                    <a href="#" class="btn btn-outline" id="collapse-all">Collapse All</a>
                </div>
                <div class="strain-info">
                    <h3>Strain Information</h3>
                    <p id="strain-description">Select a strain to view its information.</p>
                </div>
            </div>
        </div>
    </section>

    <!-- About Section -->
    <section class="about" id="about">
        <div class="container">
            <div class="about-grid">
                <div class="about-img" style="background-color: #e0ead8; background-image: url('img/DayDreamerGenetics.jpg'); background-size: cover; background-position: center;"></div>
                <div class="about-content">
                    <h2>Our Story</h2>
                    <p>Daydreamer Genetics was born from a passion for preserving cannabis biodiversity. What started as a personal collection has grown into a dedicated seed bank with a mission to protect genetic diversity for future generations.</p>
                    <p>Our focus is not on commercial success, but on the conservation of rare, unique, and historically significant cannabis genetics that might otherwise be lost to time.</p>
                    <a href="#contact" class="btn">Connect With Us</a>
                </div>
            </div>
        </div>
    </section>

    <!-- Chat Widget -->
    <div class="chat-widget">
        <div class="chat-btn" id="chat-toggle">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
                <path d="M12 1c-6.627 0-12 4.364-12 9.749 0 3.131 1.817 5.917 4.64 7.7.868 2.167-1.083 4.008-3.142 4.503 2.271.195 6.311-.121 9.374-2.498 7.095.538 13.128-3.997 13.128-9.705 0-5.385-5.373-9.749-12-9.749z"/>
            </svg>
        </div>
        <div class="chat-popup" id="chat-popup">
            <div class="chat-header">
                <div class="chat-title">Seed Advisor</div>
                <button class="close-chat" id="close-chat">&times;</button>
            </div>
            <div class="chat-messages" id="chat-messages">
                <div class="message bot-message">
                    Hello! I'm your seed advisor. How can I help you find the perfect genetics for your collection?
                </div>
            </div>
            <div class="chat-input">
                <input type="text" placeholder="Type your message..." id="user-input">
                <button class="send-btn" id="send-message">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
                        <path d="M2.01 21L23 12 2.01 3 2 10l15 2-15 2z"/>
                    </svg>
                </button>
            </div>
        </div>
    </div>

    <!-- Footer -->
    <footer>
        <div class="container">
            <div class="footer-grid">
                <div class="footer-col">
                    <h3>Daydreamer Genetics</h3>
                    <ul>
                        <li><a href="#home">Home</a></li>
                        <li><a href="#catalog">Catalog</a></li>
                        <li><a href="#explorer">Strain Explorer</a></li>
                        <li><a href="#about">About</a></li>
                    </ul>
                </div>
                <div class="footer-col">
                    <h3>Resources</h3>
                    <ul>
                        <li><a href="#">Grow Guides</a></li>
                        <li><a href="#">Breeding Basics</a></li>
                        <li><a href="#">Storage Tips</a></li>
                        <li><a href="#">FAQ</a></li>
                    </ul>
                </div>
                <div class="footer-col">
                    <h3>Legal</h3>
                    <ul>
                        <li><a href="#">Terms of Service</a></li>
                        <li><a href="#">Privacy Policy</a></li>
                        <li><a href="#">Shipping Policy</a></li>
                    </ul>
                </div>
                <div class="footer-col">
                    <h3>Contact</h3>
                    <ul>
                        <li><a href="mailto:info@daydreamergenetics.com">info@daydreamergenetics.com</a></li>
                        <li><a href="#">Instagram</a></li>
                    </ul>
                </div>
            </div>
            <div class="copyright">
                &copy; 2025 Daydreamer Genetics. All rights reserved.
            </div>
        </div>
    </footer>

	<script>
		// Global variables
		let i = 0; // Counter for ID generation
		let root; // Root of the tree data
		let svg; // SVG element for the tree
		let treemap; // D3 tree layout
		let strainData = {};
		let strainDescriptions = {};
		let chatPopupVisible = false;	

		// Handle sending messages
		async function sendUserMessage() {
			const userInput = document.getElementById('user-input');
			const chatMessages = document.getElementById('chat-messages');
			const message = userInput.value.trim();
			if (!message) return;
			
			// Add user message to chat
			const userMsg = document.createElement('div');
			userMsg.className = 'message user-message';
			userMsg.textContent = message;
			chatMessages.appendChild(userMsg);
			userInput.value = '';
			chatMessages.scrollTop = chatMessages.scrollHeight;
			
			// Show typing indicator
			const typingIndicator = document.createElement('div');
			typingIndicator.className = 'message bot-message typing-indicator';
			typingIndicator.innerHTML = '<span></span><span></span><span></span>';
			chatMessages.appendChild(typingIndicator);
			chatMessages.scrollTop = chatMessages.scrollHeight;
			
			try {
				// Call Pollinations API
				const response = await fetch('https://text.pollinations.ai/', {
					method: 'POST',
					headers: {'Content-Type': 'application/json'},
					body: JSON.stringify({
						messages: [
							{
								role: 'system',
								content: 'You are a helpful seed bank assistant for Daydreamer Genetics. You help users find cannabis genetics from our collection which focuses on preservation of rare and unique strains rather than commercialization. Our catalog includes Rare Landraces, Unique Crosses, and Legacy Strains. Keep responses friendly but concise.'
							},
							{ role: 'user', content: message }
						],
						model: 'openai',
						private: true,
						jsonMode: false
					})
				});
				
				// Remove typing indicator
				chatMessages.removeChild(typingIndicator);
				
				if (!response.ok) throw new Error('API request failed');
				
				// Process the text response, not JSON
				const text = await response.text();
				const botResponse = text || "Sorry, I couldn't process that.";
				
				// Add bot response to chat
				const botMsg = document.createElement('div');
				botMsg.className = 'message bot-message';
				botMsg.textContent = botResponse;
				chatMessages.appendChild(botMsg);
				chatMessages.scrollTop = chatMessages.scrollHeight;
			} catch (error) {
				console.error('Chat error:', error);
				// Remove typing indicator if it exists
				if (chatMessages.contains(typingIndicator)) {
					chatMessages.removeChild(typingIndicator);
				}
				
				// Add fallback response
				const errorMsg = document.createElement('div');
				errorMsg.className = 'message bot-message error';
				errorMsg.textContent = "Sorry, I'm having trouble connecting right now. Please try again later.";
				chatMessages.appendChild(errorMsg);
				chatMessages.scrollTop = chatMessages.scrollHeight;
			}
		}

		// This function is an improved version that will try multiple possible image filenames
		function getStrainImagePath(strain) {
			// List of possible image patterns to try
			const possiblePatterns = [
				// Standard from JSON
				`img/${strain.id}-main.jpg`,
				
				// Common variations
				`img/${strain.id.replace(/-/g, '')}-main.jpg`,  // No hyphens (garryscanna)
				`img/${strain.id}-logo.jpg`,
				
				// Try with name instead of ID
				`img/${strain.name.toLowerCase().replace(/\s+/g, '-')}-main.jpg`,
				`img/${strain.name.toLowerCase().replace(/[^a-z0-9]/g, '')}-main.jpg`,
				
				// Fallback placeholder
				`img/placeholder-strain.jpg`
			];
			
			// Return all patterns for the actual image loading to try
			return possiblePatterns;
		}

		function populateStrainCatalog() {
			const strainGrid = document.getElementById('strain-grid');
			
			// Clear existing strains
			strainGrid.innerHTML = '';
			
			// Get strain data from your JSON
			fetchStrainData().then(data => {
				// Debug: check if we're getting strain data
				console.log("Populating catalog with strain data:", data);
				
				// Get all strains from the data
				const strains = data.strains || [];
				
				if (strains.length === 0) {
					strainGrid.innerHTML = '<p class="no-strains">No strains found in catalog.</p>';
					return;
				}
				
				// Create a card for each strain
				strains.forEach(strain => {
					// Create strain card
					const card = document.createElement('div');
					card.className = 'strain-card';
					
					// Image path - use strain id to find the image
					const imagePath = `img/${strain.id}-main.jpg`;
					
					// Create HTML for the card - with just one simple fallback
					card.innerHTML = `
						<div class="strain-image">
							<img src="${imagePath}" alt="${strain.name}" onerror="this.src='img/placeholder-strain.jpg'">
						</div>
						<div class="strain-card-content">
							<h3>${strain.name}</h3>
							<div class="strain-type">${strain.dominance || 'Hybrid'}</div>
							<p class="strain-description">${strain.description.substring(0, 100)}...</p>
							<div class="strain-details">
								<div class="strain-genetics">
									Sativa: ${strain.genetics?.sativa || 0}% | 
									Indica: ${strain.genetics?.indica || 0}%
								</div>
								<div class="strain-availability">${strain.availabilityStatus || 'Unknown'}</div>
							</div>
						</div>
					`;
					
					// Add card to grid
					strainGrid.appendChild(card);
					
					// Add click event to view strain details
					card.addEventListener('click', function() {
						console.log(`Strain clicked: ${strain.name}`);
						// Show strain description
						document.getElementById('strain-description').innerText = strain.description || "No information available for this strain.";
					});
				});
				
				// Add filter functionality
				const typeFilter = document.getElementById('type-filter');
				typeFilter.addEventListener('change', function() {
					const filterValue = this.value;
					
					document.querySelectorAll('.strain-card').forEach(card => {
						if (filterValue === 'all') {
							card.style.display = 'block';
							return;
						}
						
						const type = card.querySelector('.strain-type').textContent;
						card.style.display = type.toLowerCase().includes(filterValue.toLowerCase()) ? 'block' : 'none';
					});
				});
			});
		}
		
		function navigateToSection(sectionId) {
			// Don't hide all sections, instead show the one requested
			const targetSection = document.getElementById(sectionId);
			
			if (targetSection) {
				// Scroll to the section
				targetSection.scrollIntoView({ behavior: 'smooth' });
				
				// For debugging
				console.log(`Navigating to section: ${sectionId}`);
			} else {
				console.error(`Section with ID ${sectionId} not found`);
			}
		}
			
		// Fallback data in case the fetch fails
		function getBackupStrainData() {
			return {
				"strains": [
					{
						"id": "frankenstrain",
						"name": "Frankenstrain",
						"breedingType": "F1",
						"type": "photoperiod",
						"dominance": "indica-dominant",
						"genetics": {
							"sativa": 30,
							"indica": 70,
							"ruderalis": 0
						},
						"description": "A powerful indica-dominant hybrid with monstrous effects. Frankenstrain combines unknown genetics to create a beast of a strain with deep relaxation properties.",
						"availabilityStatus": "in-stock"
					},
					{
						"id": "garys-canna",
						"name": "Gary's Canna",
						"breedingType": "F1",
						"type": "photoperiod",
						"dominance": "balanced",
						"genetics": {
							"sativa": 50,
							"indica": 50,
							"ruderalis": 0
						},
						"description": "Gary's Canna is a perfectly balanced hybrid with equal parts relaxation and cerebral effects. A house favorite with beautiful resin production.",
						"availabilityStatus": "in-stock"
					},
					{
						"id": "garys-canna-cherries",
						"name": "Gary's Canna Cherries",
						"breedingType": "F1",
						"type": "photoperiod",
						"dominance": "balanced",
						"genetics": {
							"sativa": 45,
							"indica": 55,
							"ruderalis": 0
						},
						"description": "A delicious cross of Gary's Canna with distinct cherry flavors. This strain produces buds with a sweet, fruity aroma and a pleasant balanced high.",
						"availabilityStatus": "in-stock"
					},
					{
						"id": "garys-vanilla-cream",
						"name": "Gary's Vanilla Cream",
						"breedingType": "F1",
						"type": "photoperiod",
						"dominance": "indica-dominant",
						"genetics": {
							"sativa": 30,
							"indica": 70,
							"ruderalis": 0
						},
						"description": "A creamy, smooth variant of Gary's Canna with distinct vanilla undertones. This indica-dominant hybrid provides deep relaxation with a pleasant, sweet flavor profile.",
						"availabilityStatus": "limited"
					},
					{
						"id": "tangerine-truffle",
						"name": "Tangerine Truffle",
						"breedingType": "F1",
						"type": "photoperiod",
						"dominance": "sativa-dominant",
						"genetics": {
							"sativa": 70,
							"indica": 30,
							"ruderalis": 0
						},
						"description": "Tangerine Truffle combines citrus notes with deep chocolate undertones. This sativa-dominant hybrid provides an uplifting, creative high perfect for daytime use.",
						"availabilityStatus": "in-stock"
					},
					{
						"id": "grandpas-cake",
						"name": "Grandpa's Cake",
						"breedingType": "F1",
						"type": "photoperiod",
						"dominance": "indica-dominant",
						"genetics": {
							"sativa": 20,
							"indica": 80,
							"ruderalis": 0
						},
						"description": "Grandpa's Cake offers sweet, cake-like flavors with a powerful indica punch. This strain is ideal for evening use, providing deep body relaxation and peaceful sleep.",
						"availabilityStatus": "in-stock"
					}
				],
				"strainTree": {
					"name": "Strain Lineage",
					"children": [
						{
							"name": "Gary's Canna Cherries",
							"children": []
						},
						{
							"name": "Frankenstrain",
							"children": []
						},
						{
							"name": "Tangerine Truffle",
							"children": []
						},
						{
							"name": "Grandpa's Cake",
							"children": []
						}
					]
				}
			};
		}

		// Updated fetchStrainData to use the backup data if remote fetch fails
		async function fetchStrainData() {
			try {
				const response = await fetch('https://www.ai-ministries.com/daydreamer_strains.json');
				
				if (!response.ok) {
					console.error(`Failed to fetch JSON: ${response.status}`);
					throw new Error(`Failed to fetch JSON: ${response.status}`);
				}
				
				const data = await response.json();
				console.log("Loaded strain data from remote source:", data);
				
				// Create descriptions object from strains array
				const descriptions = {};
				if (data.strains && Array.isArray(data.strains)) {
					data.strains.forEach(strain => {
						descriptions[strain.name] = strain.description;
					});
				}
				
				return {
					strainTree: data.strainTree || { name: "No strain tree found", children: [] },
					strains: data.strains || [],
					descriptions: descriptions
				};
			} catch (error) {
				console.error("Error loading remote strain data:", error);
				console.log("Using backup strain data instead");
				
				// Use hardcoded backup data
				const backupData = getBackupStrainData();
				
				// Create descriptions object from backup strains array
				const descriptions = {};
				if (backupData.strains && Array.isArray(backupData.strains)) {
					backupData.strains.forEach(strain => {
						descriptions[strain.name] = strain.description;
					});
				}
				
				return {
					strainTree: backupData.strainTree || { name: "Strain Lineage", children: [] },
					strains: backupData.strains || [],
					descriptions: descriptions
				};
			}
		}
		
		// Initialize the visualization
		async function initializeVisualization() {
			const data = await fetchStrainData();
			strainData = data.strainTree;
			strainDescriptions = data.descriptions;
			
			console.log("Initializing visualization with data:", strainData);
			console.log("Descriptions:", strainDescriptions);
			
			// If no strainTree data is available
			if (!strainData || !strainData.name) {
				document.getElementById('strain-tree').innerHTML = '<p class="error-message">Error loading strain tree data</p>';
				return;
			}
			
			// D3.js Strain Tree Visualization
			const width = document.getElementById('strain-tree').clientWidth;
			const height = 350;
			const margin = {top: 20, right: 90, bottom: 20, left: 90};
			
			// Clear any existing SVG
			d3.select('#strain-tree').select('svg').remove();
			
			// Create SVG
			svg = d3.select('#strain-tree')
				.append('svg')
				.attr('width', width)
				.attr('height', height)
				.append('g')
				.attr('transform', `translate(${margin.left},${margin.top})`);
			
			// Create tree layout
			treemap = d3.tree().size([height - margin.top - margin.bottom, width - margin.left - margin.right]);
			
			// Prepare data
			root = d3.hierarchy(strainData);
			root.x0 = height / 2;
			root.y0 = 0;
			
			// Collapse all nodes initially except the first level
			if (root.children) {
				root.children.forEach(collapse);
			}
			
			// Start the visualization
			update(root);
		}
		
		// Helper functions for the tree visualization
		function collapse(d) {
			if (d.children) {
				d._children = d.children;
				d._children.forEach(collapse);
				d.children = null;
			}
		}
		
		function expand(d) {
			if (d._children) {
				d.children = d._children;
				d._children = null;
			}
		}
		
		function update(source) {
			// Debug: Check what data is being passed to update
			console.log("Updating visualization with source:", source);
			
			// Assigns the x and y position for the nodes
			const treeData = treemap(root);
			
			// Get the nodes and links from the hierarchy
			const nodes = treeData.descendants();
			const links = treeData.descendants().slice(1);
			
			// Debug: Check how many nodes we have
			console.log("Number of nodes:", nodes.length);
			
			// Normalize for fixed-depth
			nodes.forEach(d => {
				d.y = d.depth * 180;
			});
			
			// ****************** Nodes section ***************************
			
			// Update the nodes...
			const node = svg.selectAll('g.node')
				.data(nodes, d => d.id || (d.id = ++i));
			
			// Enter any new nodes at the parent's previous position
			const nodeEnter = node.enter().append('g')
				.attr('class', 'node')
				.attr('transform', d => `translate(${source.y0},${source.x0})`)
				.on('click', (event, d) => click(event, d));
			
			// Add Circle for the nodes
			nodeEnter.append('circle')
				.attr('class', 'node')
				.attr('r', 1e-6)
				.style('fill', d => d._children ? '#6fb97a' : '#fff')
				.style('stroke', '#3a7d44')
				.style('stroke-width', 2);
			
			// Add labels for the nodes
			nodeEnter.append('text')
				.attr('dy', '.35em')
				.attr('x', d => d.children || d._children ? -13 : 13)
				.attr('text-anchor', d => d.children || d._children ? 'end' : 'start')
				.text(d => d.data.name)
				.style('font-size', '12px')
				.style('fill', '#f2f7f3');
			
			// UPDATE
			const nodeUpdate = nodeEnter.merge(node);
			
			// Transition to the proper position for the node
			nodeUpdate.transition()
				.duration(750)
				.attr('transform', d => `translate(${d.y},${d.x})`);
			
			// Update the node attributes and style
			nodeUpdate.select('circle.node')
				.attr('r', 10)
				.style('fill', d => d._children ? '#6fb97a' : '#fff')
				.style('stroke', '#3a7d44')
				.attr('cursor', 'pointer');
			
			// Remove any exiting nodes
			const nodeExit = node.exit().transition()
				.duration(750)
				.attr('transform', d => `translate(${source.y},${source.x})`)
				.remove();
			
			// On exit reduce the node circles size to 0
			nodeExit.select('circle')
				.attr('r', 1e-6);
			
			// On exit reduce the opacity of text labels
			nodeExit.select('text')
				.style('fill-opacity', 1e-6);
			
			// ****************** links section ***************************
			
			// Update the links...
			const link = svg.selectAll('path.link')
				.data(links, d => d.id);
			
			// Enter any new links at the parent's previous position
			const linkEnter = link.enter().insert('path', 'g')
				.attr('class', 'link')
				.attr('d', d => {
					const o = {x: source.x0, y: source.y0};
					return diagonal(o, o);
				})
				.style('fill', 'none')
				.style('stroke', '#6fb97a')
				.style('stroke-width', 2);
			
			// UPDATE
			const linkUpdate = linkEnter.merge(link);
			
			// Transition back to the parent element position
			linkUpdate.transition()
				.duration(750)
				.attr('d', d => diagonal(d, d.parent));
			
			// Remove any exiting links
			link.exit().transition()
				.duration(750)
				.attr('d', d => {
					const o = {x: source.x, y: source.y};
					return diagonal(o, o);
				})
				.remove();
			
			// Store the old positions for transition
			nodes.forEach(d => {
				d.x0 = d.x;
				d.y0 = d.y;
			});
			
			// Show strain description when clicking on a node
			document.getElementById('strain-description').innerText = 
				strainDescriptions[source.data.name] || "No information available for this strain.";
		}

		// Creates a curved (diagonal) path from parent to the child nodes
		function diagonal(s, d) {
			return `M ${s.y} ${s.x}
					C ${(s.y + d.y) / 2} ${s.x},
					  ${(s.y + d.y) / 2} ${d.x},
					  ${d.y} ${d.x}`;
		}

		// Toggle children on click
		function click(event, d) {
			if (d.children) {
				d._children = d.children;
				d.children = null;
			} else {
				d.children = d._children;
				d._children = null;
			}
			
			// Update the tree
			update(d);
			
			// Update strain information display
			document.getElementById('strain-description').innerText = 
				strainDescriptions[d.data.name] || "No information available for this strain.";
		}
		
		// Function to safely load strain images with fallbacks
		function loadStrainImage(strain, imageType = 'main') {
			return new Promise((resolve) => {
				// Get the image path from strain data
				const imagePath = strain.images && strain.images[imageType] 
				? `images/strains/${strain.images[imageType]}` 
				: null;
				
				if (!imagePath) {
					// No image specified, resolve with default placeholder
					resolve(`images/placeholder-strain.jpg`);
					return;
				}
				
				// Try to load the image
				const img = new Image();
				img.onload = () => resolve(imagePath);
				img.onerror = () => {
					// Image failed to load, use placeholder instead
					resolve(`images/placeholder-strain.jpg`);
				};
				img.src = imagePath;
			});
		}
		
		// Usage example for strain cards
		async function displayStrainCard(strain, containerElement) {
			// Get image path based on strain ID
			let imageSrc = `images/${strain.id}-logo.jpg`;
			
			const strainCard = document.createElement('div');
			strainCard.className = 'strain-card';
			strainCard.innerHTML = `
				<div class="strain-image">
					<img src="${imageSrc}" alt="${strain.name}" onerror="this.src='images/placeholder-strain.jpg'">
				</div>
				<div class="strain-info">
					<h3>${strain.name}</h3>
					<p>${strain.description}</p>
				</div>
			`;
			
			containerElement.appendChild(strainCard);
		}
		
		// Handle expand/collapse all buttons
		document.getElementById('expand-all').addEventListener('click', function(e) {
			e.preventDefault();
			if (root) {
				root.descendants().forEach(expand);
				update(root);
			}
		});
		
		document.getElementById('collapse-all').addEventListener('click', function(e) {
			e.preventDefault();
			if (root && root.children) {
				root.children.forEach(collapse);
				update(root);
			}
		});
		
		// Event listener setups
		document.addEventListener('DOMContentLoaded', function() {
			// Chat widget functionality
			const chatToggle = document.getElementById('chat-toggle');
			const chatPopup = document.getElementById('chat-popup');
			const closeChat = document.getElementById('close-chat');
			const userInput = document.getElementById('user-input');
			const sendMessage = document.getElementById('send-message');
			
			// Set initial state
			chatPopup.style.display = 'none';
			
			// Don't hide all sections - let them display naturally
			
			// Event listeners
			chatToggle.addEventListener('click', function() {
				console.log('Chat button clicked');
				if (chatPopup.style.display === 'block') {
					chatPopup.style.display = 'none';
				} else {
					chatPopup.style.display = 'block';
				}
			});
			
			// Hero buttons - use smooth scrolling
			document.querySelectorAll('.hero .btn').forEach(button => {
				button.addEventListener('click', function(e) {
					e.preventDefault();
					const targetId = this.getAttribute('href').substring(1);
					navigateToSection(targetId);
				});
			});
			
			// View Collection buttons in catalog section
			document.querySelectorAll('.feature-content .btn').forEach(button => {
				button.addEventListener('click', function(e) {
					e.preventDefault();
					// Navigate to catalog section
					navigateToSection('strain-catalog');
				});
			});
			
			closeChat.addEventListener('click', function() {
				chatPopup.style.display = 'none';
			});
			
			sendMessage.addEventListener('click', function() {
				sendUserMessage();
			});
			
			userInput.addEventListener('keypress', function(e) {
				if (e.key === 'Enter') {
					sendUserMessage();
				}
			});
			
			// Navigation links - smooth scrolling
			document.querySelectorAll('nav ul li a').forEach(link => {
				link.addEventListener('click', function(e) {
					e.preventDefault();
					const targetId = this.getAttribute('href').substring(1);
					navigateToSection(targetId);
				});
			});
			
			// Debug: Log that we're about to initialize key components
			console.log("Initializing strain catalog and visualization");
			
			// Populate Strain Catalog
			populateStrainCatalog();
			
			// Initialize the visualization with a slight delay to ensure DOM is ready
			setTimeout(function() {
				initializeVisualization();
			}, 500);
			
			// Log that initialization is complete
			console.log("Initialization complete");
		});
	</script>
</body>
</html>