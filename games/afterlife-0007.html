<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Choose Your Afterlife</title>
    <style>
        body {
            margin: 0;
            padding: 0;
            font-family: Arial, sans-serif;
            background-color: #1a1a1a;
            color: #ffffff;
        }

        .game-container {
            margin-top: 72px; /* Space for nav */
            padding: 2rem;
            max-width: 800px;
            margin-left: auto;
            margin-right: auto;
        }

        .game-card {
            background-color: #2a2a2a;
            border-radius: 15px;
            padding: 2rem;
            margin-bottom: 2rem;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.2);
        }

        .host-container {
            display: flex;
            align-items: center;
            margin-bottom: 2rem;
            gap: 1rem;
        }

        .host-avatar {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            background-color: #dc2626;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 2rem;
        }

        .host-message {
            flex: 1;
            background-color: #333;
            padding: 1rem;
            border-radius: 10px;
        }

        .choice-container {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 1rem;
            margin-top: 1rem;
        }

        .choice-button {
            background-color: #333;
            border: 2px solid #dc2626;
            color: white;
            padding: 1rem;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 1rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
            position: relative;
        }

        .choice-button:hover {
            background-color: #dc2626;
            transform: translateY(-2px);
            z-index: 10;
        }

        .tooltip {
            position: absolute;
            background: rgba(0, 0, 0, 0.95);
            color: white;
            padding: 0.75rem;
            border-radius: 5px;
            font-size: 0.85rem;
            width: 220px;
            top: calc(100% + 10px);
            left: 50%;
            transform: translateX(-50%);
            z-index: 20;
            border: 1px solid #dc2626;
            pointer-events: none;
            opacity: 0;
            visibility: hidden;
            transition: all 0.2s ease;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.3);
        }

        .choice-button:hover .tooltip {
            opacity: 1;
            visibility: visible;
        }

        .outcome-image {
            width: 100%;
            height: 300px;
            border-radius: 10px;
            margin: 1rem 0;
            object-fit: cover;
            position: relative;
        }

        .refresh-image {
            position: absolute;
            top: 10px;
            right: 10px;
            background: rgba(0, 0, 0, 0.7);
            border: none;
            color: white;
            width: 30px;
            height: 30px;
            border-radius: 50%;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.2rem;
            transition: transform 0.3s ease;
        }

        .refresh-image:hover {
            transform: rotate(180deg);
        }

        .progress-bar {
            background-color: #333;
            border-radius: 10px;
            height: 10px;
            margin: 2rem 0;
            overflow: hidden;
        }

        .progress-fill {
            background-color: #dc2626;
            height: 100%;
            width: 0%;
            transition: width 0.5s ease;
        }
    </style>
</head>
<body>
    <div class="game-container">
        <div class="game-card">
            <div class="host-container">
                <div class="host-avatar">üëª</div>
                <div class="host-message">
                    Welcome, seeker! I am your Afterlife Guide. Ready to discover your eternal destiny?
                    Let's begin with some simple questions about your beliefs...
                </div>
            </div>
            
            <div class="progress-bar">
                <div class="progress-fill" style="width: 0%"></div>
            </div>

            <div id="question-container">
                <h3>First, tell me about your current spiritual beliefs:</h3>
                <div class="outcome-image-container" style="position: relative;">
                    <img id="journeyImage" class="outcome-image" alt="Spiritual journey visualization">
                    <button class="refresh-image" onclick="refreshImage()">üîÑ</button>
                </div>
                <div class="choice-container">
                    <button class="choice-button" data-value="abrahamic">
                        ‚úùÔ∏è Abrahamic Faiths
                        <span class="tooltip">Including Christianity, Catholicism, Islam, and Judaism</span>
                    </button>
                    <button class="choice-button" data-value="dharmic">
                        üïâÔ∏è Dharmic Traditions
                        <span class="tooltip">Including Hinduism, Buddhism, Jainism, and Sikhism</span>
                    </button>
                    <button class="choice-button" data-value="pagan">
                        üåô Earth-Based Spirituality
                        <span class="tooltip">Including Wicca, Paganism, and Nature-based beliefs</span>
                    </button>
                    <button class="choice-button" data-value="philosophical">
                        ü§î Philosophical
                        <span class="tooltip">Including Agnosticism and Spiritual-but-not-religious</span>
                    </button>
                    <button class="choice-button" data-value="atheistic">
                        ‚öõÔ∏è Atheistic
                        <span class="tooltip">Including Atheism, Secular Humanism, and Materialism</span>
                    </button>
                    <button class="choice-button" data-value="nihilistic">
                        üåå Nihilistic
                        <span class="tooltip">Including Existential Nihilism and Non-belief in afterlife</span>
                    </button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Image cache
        const imageCache = {
            currentImage: null
        };

        // Utility functions
        function getRandomSeed() {
            return Math.floor(Math.random() * 99999999);
        }

        async function loadJourneyImage(forceRefresh = false) {
            const imageElement = document.getElementById('journeyImage');
            
            if (!forceRefresh && imageCache.currentImage) {
                imageElement.src = imageCache.currentImage;
                return;
            }

            const prompt = "Large letters read 'AFTERLIFE' as 3D text centered and shows icons from major afterlife beliefs including heavenly gates, cosmic wheels of rebirth, spiritual voids, ancestral spirits, and celestial realms around the text in a gamified hyperrealistic style";
            const seed = getRandomSeed();
            const imageUrl = `https://image.pollinations.ai/prompt/${encodeURIComponent(prompt)}?seed=${seed}&width=800&height=400&nologo=true`;
            
            try {
                imageElement.style.opacity = '0.5';
                
                const response = await fetch(imageUrl);
                const blob = await response.blob();
                const base64 = await new Promise((resolve) => {
                    const reader = new FileReader();
                    reader.onloadend = () => resolve(reader.result);
                    reader.readAsDataURL(blob);
                });

                imageCache.currentImage = base64;
                imageElement.src = base64;
                imageElement.style.opacity = '1';
            } catch (error) {
                console.error('Failed to load image:', error);
                imageElement.src = '/api/placeholder/800/400';
            }
        }

        function refreshImage() {
            loadJourneyImage(true);
        }

        // Load initial image on page load
        document.addEventListener('DOMContentLoaded', () => {
            loadJourneyImage();
        });

        // Image cache management
    const IMAGE_CACHE_KEYS = {
        TITLE: 'afterlife_title_image',
        QUESTION: 'afterlife_question_image',
        OUTCOME: 'afterlife_outcome_image'
    };

    // Load image from localStorage or generate new one
    async function loadJourneyImage(forceRefresh = false, prompt = '', cacheKey = IMAGE_CACHE_KEYS.TITLE) {
        const imageElement = document.getElementById('journeyImage');
        
        // Try to get from localStorage first unless forced refresh
        if (!forceRefresh) {
            const cachedImage = localStorage.getItem(cacheKey);
            if (cachedImage) {
                imageElement.src = cachedImage;
                return;
            }
        }

        // If we need to generate a new image
        const defaultPrompt = "Large letters read 'AFTERLIFE' as 3D text centered and shows icons from major afterlife beliefs including heavenly gates, cosmic wheels of rebirth, spiritual voids, ancestral spirits, and celestial realms around the text in a gamified hyperrealistic style";
        const imagePrompt = prompt || defaultPrompt;
        
        try {
            imageElement.style.opacity = '0.5';
            
            const seed = getRandomSeed();
            const imageUrl = `https://image.pollinations.ai/prompt/${encodeURIComponent(imagePrompt)}?seed=${seed}&width=800&height=400&nologo=true`;
            
            const response = await fetch(imageUrl);
            const blob = await response.blob();
            const base64 = await new Promise((resolve) => {
                const reader = new FileReader();
                reader.onloadend = () => resolve(reader.result);
                reader.readAsDataURL(blob);
            });

            // Save to localStorage
            localStorage.setItem(cacheKey, base64);
            
            imageElement.src = base64;
            imageElement.style.opacity = '1';
        } catch (error) {
            console.error('Failed to load image:', error);
            imageElement.src = '/api/placeholder/800/400';
        }
    }

    // Specific functions for different image types
    async function loadQuestionImage(question, forceRefresh = false) {
        const prompt = `Spiritual journey scene showing ${question.question} with mystical and ethereal elements, game art style`;
        await loadJourneyImage(forceRefresh, prompt, IMAGE_CACHE_KEYS.QUESTION);
    }

    async function loadOutcomeImage(outcomes, forceRefresh = false) {
        const prompt = `${outcomes.primary.outcome}, rendered as a spiritual journey destination with mystical elements and ethereal atmosphere, cinematic game art style`;
        await loadJourneyImage(forceRefresh, prompt, IMAGE_CACHE_KEYS.OUTCOME);
    }

    // Reset all cached images
    function resetImageCache() {
        Object.values(IMAGE_CACHE_KEYS).forEach(key => {
            localStorage.removeItem(key);
        });
    }

    // Clear cache on new journey start
    function restartJourney() {
        resetImageCache();
        // ... rest of restart logic
            abrahamic: 0,
            dharmic: 0,
            earthBased: 0,
            philosophical: 0,
            atheistic: 0,
            nihilistic: 0
        },
        // Track moral/ethical scores separately
        karmaScore: 50,
        moralityScore: 50,
        // Store all answers for final calculation
        answers: [],
        // Track which beliefs are still possible outcomes
        viableBeliefs: new Set(['abrahamic', 'dharmic', 'earthBased', 'philosophical', 'atheistic', 'nihilistic'])
    };

    // Question impact definition - how each answer affects different belief systems
    const questionImpacts = {
        // Example question impacts multiple belief systems
        helpOthers: {
            question: "How do you treat others in need?",
            choices: [
                {
                    text: "ü§ù Always help others",
                    impacts: {
                        abrahamic: 5,  // Aligns with religious charity
                        dharmic: 5,    // Good karma
                        earthBased: 3, // Community connection
                        philosophical: 4, // Ethical behavior
                        atheistic: 4,  // Humanist values
                        nihilistic: -2 // Might conflict with pure nihilism
                    },
                    karma: 5,
                    morality: 5
                },
                {
                    text: "üôÇ Help when convenient",
                    impacts: {
                        abrahamic: 2,
                        dharmic: 2,
                        earthBased: 2,
                        philosophical: 2,
                        atheistic: 3,
                        nihilistic: 1
                    },
                    karma: 2,
                    morality: 2
                }
            ]
        },
        
        afterlifeBelief: {
            question: "What happens after death?",
            choices: [
                {
                    text: "üëº Journey to a higher realm",
                    impacts: {
                        abrahamic: 8,
                        dharmic: 5,
                        earthBased: 4,
                        philosophical: 2,
                        atheistic: -5,
                        nihilistic: -8
                    },
                    karma: 0,
                    morality: 0
                },
                {
                    text: "üîÑ Reincarnation",
                    impacts: {
                        abrahamic: -2,
                        dharmic: 8,
                        earthBased: 5,
                        philosophical: 3,
                        atheistic: -4,
                        nihilistic: -6
                    },
                    karma: 0,
                    morality: 0
                }
            ]
        }
    };

    function updateScores(choice) {
        // Update all belief system scores based on choice impacts
        Object.entries(choice.impacts).forEach(([belief, impact]) => {
            gameState.affinityScores[belief] += impact;
            
            // If score goes too negative, remove from viable beliefs
            if (gameState.affinityScores[belief] < -20) {
                gameState.viableBeliefs.delete(belief);
            }
        });

        // Update karma and morality
        gameState.karmaScore += choice.karma || 0;
        gameState.moralityScore += choice.morality || 0;

        // Keep scores in bounds
        gameState.karmaScore = Math.max(0, Math.min(100, gameState.karmaScore));
        gameState.moralityScore = Math.max(0, Math.min(100, gameState.moralityScore));
    }

    function calculateOutcome() {
        // Get viable beliefs sorted by affinity score
        const rankedBeliefs = Array.from(gameState.viableBeliefs)
            .map(belief => ({
                belief,
                score: gameState.affinityScores[belief],
                karma: gameState.karmaScore,
                morality: gameState.moralityScore
            }))
            .sort((a, b) => b.score - a.score);

        // Calculate primary and secondary outcomes
        const outcomes = {
            primary: getBeliefOutcome(rankedBeliefs[0]),
            secondary: rankedBeliefs[1] ? getBeliefOutcome(rankedBeliefs[1]) : null,
            karmaLevel: getKarmaLevel(gameState.karmaScore),
            moralityLevel: getMoralityLevel(gameState.moralityScore)
        };

        return outcomes;
    }

    function getBeliefOutcome(beliefData) {
        const outcomes = {
            abrahamic: {
                high: "The Pearly Gates await - eternal paradise beckons",
                mid: "A period of spiritual refinement before ascension",
                low: "A challenging path of redemption lies ahead"
            },
            dharmic: {
                high: "Moksha - liberation from the cycle of rebirth",
                mid: "A favorable reincarnation based on your karma",
                low: "Several cycles of rebirth to achieve enlightenment"
            },
            earthBased: {
                high: "Union with nature's eternal spirit",
                mid: "Journey through the Summerlands",
                low: "A period of spiritual cleansing"
            },
            philosophical: {
                high: "Transcendence to a higher state of understanding",
                mid: "Peaceful acceptance of the natural order",
                low: "Contemplative transition"
            },
            atheistic: {
                high: "Your positive impact lives on through others",
                mid: "Your memory persists in the minds of others",
                low: "A quiet return to the cosmos"
            },
            nihilistic: {
                high: "Perfect peace in the void",
                mid: "Quiet dissolution of consciousness",
                low: "Fade into nothingness"
            }
        };

        const level = beliefData.score > 30 ? "high" : 
                     beliefData.score > 10 ? "mid" : "low";

        return {
            belief: beliefData.belief,
            outcome: outcomes[beliefData.belief][level],
            score: beliefData.score
        };
    }

    function getKarmaLevel(karma) {
        if (karma >= 80) return "Exceptionally Positive";
        if (karma >= 60) return "Generally Positive";
        if (karma >= 40) return "Balanced";
        if (karma >= 20) return "Somewhat Troubled";
        return "Heavily Burdened";
    }

    function getMoralityLevel(morality) {
        if (morality >= 80) return "Saintly";
        if (morality >= 60) return "Virtuous";
        if (morality >= 40) return "Moderate";
        if (morality >= 20) return "Questionable";
        return "Corrupted";
    }

    // Question sets with full impact definitions
    const questionSets = [
        {
            question: "How do you view death?",
            choices: [
                {
                    text: "üïäÔ∏è A transition to another realm",
                    impacts: {
                        abrahamic: 10,
                        dharmic: 8,
                        earthBased: 5,
                        philosophical: 3,
                        atheistic: -5,
                        nihilistic: -8
                    },
                    karma: 2,
                    morality: 0
                },
                {
                    text: "üîÑ Part of a continuous cycle",
                    impacts: {
                        abrahamic: -2,
                        dharmic: 10,
                        earthBased: 8,
                        philosophical: 5,
                        atheistic: -3,
                        nihilistic: -5
                    },
                    karma: 2,
                    morality: 0
                },
                {
                    text: "‚ö° The final end of existence",
                    impacts: {
                        abrahamic: -8,
                        dharmic: -8,
                        earthBased: -5,
                        philosophical: 2,
                        atheistic: 10,
                        nihilistic: 8
                    },
                    karma: 0,
                    morality: 0
                },
                {
                    text: "‚ùì An unknowable mystery",
                    impacts: {
                        abrahamic: 2,
                        dharmic: 2,
                        earthBased: 2,
                        philosophical: 10,
                        atheistic: 5,
                        nihilistic: 3
                    },
                    karma: 1,
                    morality: 0
                }
            ]
        },
        {
            question: "What drives your moral decisions?",
            choices: [
                {
                    text: "üìñ Religious teachings",
                    impacts: {
                        abrahamic: 8,
                        dharmic: 8,
                        earthBased: 5,
                        philosophical: -2,
                        atheistic: -5,
                        nihilistic: -3
                    },
                    karma: 3,
                    morality: 5
                },
                {
                    text: "üí≠ Personal philosophy",
                    impacts: {
                        abrahamic: -2,
                        dharmic: 3,
                        earthBased: 3,
                        philosophical: 10,
                        atheistic: 5,
                        nihilistic: 2
                    },
                    karma: 2,
                    morality: 3
                },
                {
                    text: "üß¨ Scientific reasoning",
                    impacts: {
                        abrahamic: -5,
                        dharmic: -3,
                        earthBased: -2,
                        philosophical: 5,
                        atheistic: 10,
                        nihilistic: 3
                    },
                    karma: 1,
                    morality: 2
                },
                {
                    text: "üåü Intuition and feelings",
                    impacts: {
                        abrahamic: 3,
                        dharmic: 5,
                        earthBased: 10,
                        philosophical: 2,
                        atheistic: -3,
                        nihilistic: -2
                    },
                    karma: 2,
                    morality: 2
                }
            ]
        },
        {
            question: "How do you handle life's suffering?",
            choices: [
                {
                    text: "üôè Prayer and faith",
                    impacts: {
                        abrahamic: 10,
                        dharmic: 5,
                        earthBased: 3,
                        philosophical: -2,
                        atheistic: -8,
                        nihilistic: -5
                    },
                    karma: 3,
                    morality: 2
                },
                {
                    text: "üßò Meditation and acceptance",
                    impacts: {
                        abrahamic: 2,
                        dharmic: 10,
                        earthBased: 8,
                        philosophical: 5,
                        atheistic: 2,
                        nihilistic: 3
                    },
                    karma: 5,
                    morality: 3
                },
                {
                    text: "üí™ Action and problem-solving",
                    impacts: {
                        abrahamic: 2,
                        dharmic: 2,
                        earthBased: 3,
                        philosophical: 5,
                        atheistic: 8,
                        nihilistic: -2
                    },
                    karma: 2,
                    morality: 4
                },
                {
                    text: "üåå Accepting its inevitability",
                    impacts: {
                        abrahamic: -3,
                        dharmic: 5,
                        earthBased: 2,
                        philosophical: 5,
                        atheistic: 3,
                        nihilistic: 10
                    },
                    karma: 0,
                    morality: 0
                }
            ]
        },
        {
            question: "What happens to consciousness after death?",
            choices: [
                {
                    text: "üëª It continues eternally",
                    impacts: {
                        abrahamic: 10,
                        dharmic: 8,
                        earthBased: 5,
                        philosophical: 2,
                        atheistic: -8,
                        nihilistic: -10
                    },
                    karma: 2,
                    morality: 0
                },
                {
                    text: "üîÑ It transforms and recycles",
                    impacts: {
                        abrahamic: -2,
                        dharmic: 10,
                        earthBased: 8,
                        philosophical: 3,
                        atheistic: -5,
                        nihilistic: -8
                    },
                    karma: 2,
                    morality: 0
                },
                {
                    text: "üí´ It dissolves into nothing",
                    impacts: {
                        abrahamic: -8,
                        dharmic: -5,
                        earthBased: -3,
                        philosophical: 2,
                        atheistic: 10,
                        nihilistic: 8
                    },
                    karma: 0,
                    morality: 0
                },
                {
                    text: "‚ùì It's beyond understanding",
                    impacts: {
                        abrahamic: 2,
                        dharmic: 3,
                        earthBased: 3,
                        philosophical: 10,
                        atheistic: 2,
                        nihilistic: 2
                    },
                    karma: 1,
                    morality: 0
                }
            ]
        },
        {
            question: "How do you view good and evil?",
            choices: [
                {
                    text: "‚öîÔ∏è Absolute forces in conflict",
                    impacts: {
                        abrahamic: 10,
                        dharmic: -3,
                        earthBased: 2,
                        philosophical: -2,
                        atheistic: -5,
                        nihilistic: -8
                    },
                    karma: 2,
                    morality: 5
                },
                {
                    text: "‚òØÔ∏è Balanced natural forces",
                    impacts: {
                        abrahamic: -2,
                        dharmic: 10,
                        earthBased: 8,
                        philosophical: 5,
                        atheistic: 2,
                        nihilistic: -3
                    },
                    karma: 5,
                    morality: 3
                },
                {
                    text: "üß† Human constructs",
                    impacts: {
                        abrahamic: -5,
                        dharmic: -2,
                        earthBased: 2,
                        philosophical: 8,
                        atheistic: 10,
                        nihilistic: 5
                    },
                    karma: 0,
                    morality: 2
                },
                {
                    text: "üåå Meaningless concepts",
                    impacts: {
                        abrahamic: -8,
                        dharmic: -5,
                        earthBased: -3,
                        philosophical: 2,
                        atheistic: 5,
                        nihilistic: 10
                    },
                    karma: -3,
                    morality: -2
                }
            ]
        }
    ];

    function updateQuestionUI(currentStep) {
        const container = document.getElementById('question-container');
        const question = questionSets[currentStep];
        
        if (!question) {
            showOutcome();
            return;
        }

        // Update progress bar
        const progressFill = document.querySelector('.progress-fill');
        progressFill.style.width = `${((currentStep + 1) / questionSets.length) * 100}%`;

        // Update question content
        container.innerHTML = `
            <h3>${question.question}</h3>
            <div class="outcome-image-container" style="position: relative;">
                <img id="journeyImage" class="outcome-image" alt="Question visualization">
                <button class="refresh-image" onclick="refreshQuestionImage()">üîÑ</button>
            </div>
            <div class="choice-container">
                ${question.choices.map(choice => `
                    <button class="choice-button" data-impacts='${JSON.stringify(choice.impacts)}' data-karma='${choice.karma}' data-morality='${choice.morality}'>
                        ${choice.text}
                        <span class="tooltip">This choice will influence your spiritual journey</span>
                    </button>
                `).join('')}
            </div>
        `;

        // Generate question-specific image
        loadQuestionImage({ question: question.question });

        // Add click handlers to new buttons
        document.querySelectorAll('.choice-button').forEach(button => {
            button.addEventListener('click', () => {
                const impacts = JSON.parse(button.getAttribute('data-impacts'));
                const karma = parseInt(button.getAttribute('data-karma'));
                const morality = parseInt(button.getAttribute('data-morality'));

                // Update scores
                Object.entries(impacts).forEach(([belief, impact]) => {
                    gameState.affinityScores[belief] += impact;
                });
                gameState.karmaScore = Math.max(0, Math.min(100, gameState.karmaScore + karma));
                gameState.moralityScore = Math.max(0, Math.min(100, gameState.moralityScore + morality));

                // Move to next question
                gameState.currentStep++;
                updateQuestionUI(gameState.currentStep);
            });
        });
    }
            {
                text: "Have you followed the core commandments of your faith?",
                choices: [
                    { text: "üòá Always try my best", value: 3, karma: 5 },
                    { text: "üòä Most of the time", value: 2, karma: 3 },
                    { text: "üòê Sometimes struggle", value: 1, karma: 0 },
                    { text: "üòà Not really", value: 0, karma: -3 }
                ]
            }
        ],
        dharmic: [
            {
                text: "How do you view your role in the cycle of karma?",
                choices: [
                    { text: "üßò Actively working on enlightenment", value: 3, karma: 5 },
                    { text: "üïäÔ∏è Try to maintain good karma", value: 2, karma: 3 },
                    { text: "ü§∑ Sometimes think about it", value: 1, karma: 0 },
                    { text: "üå™Ô∏è Don't consider karma", value: 0, karma: -2 }
                ]
            }
        ],
        "earth-based": [
            {
                text: "How do you connect with nature and the elements?",
                choices: [
                    { text: "üå≥ Deep spiritual connection", value: 3, karma: 5 },
                    { text: "üçÉ Regular nature appreciation", value: 2, karma: 3 },
                    { text: "üå± Occasional connection", value: 1, karma: 0 },
                    { text: "üè¢ Rarely think about it", value: 0, karma: -2 }
                ]
            }
        ],
        philosophical: [
            {
                text: "How do you approach life's big questions?",
                choices: [
                    { text: "ü§ì Constant deep reflection", value: 3, karma: 3 },
                    { text: "ü§î Regular contemplation", value: 2, karma: 2 },
                    { text: "üí≠ Occasional pondering", value: 1, karma: 0 },
                    { text: "ü§∑ Avoid such thoughts", value: 0, karma: -1 }
                ]
            }
        ],
        atheistic: [
            {
                text: "How do you find meaning without religious belief?",
                choices: [
                    { text: "üåü Through helping others", value: 3, karma: 4 },
                    { text: "üìö Through knowledge and science", value: 2, karma: 3 },
                    { text: "üé® Through personal achievements", value: 1, karma: 1 },
                    { text: "üéÆ Don't seek deeper meaning", value: 0, karma: 0 }
                ]
            }
        ],
        nihilistic: [
            {
                text: "How do you cope with the concept of non-existence?",
                choices: [
                    { text: "üåå Complete acceptance", value: 3, karma: 0 },
                    { text: "ü§î Sometimes uncomfortable", value: 2, karma: 0 },
                    { text: "üò∞ Often anxious about it", value: 1, karma: 0 },
                    { text: "üò± Constant existential dread", value: 0, karma: 0 }
                ]
            }
        ]
    };

    // Universal questions for all paths
    const universalQuestions = [
        {
            text: "Have you ever intentionally harmed another being?",
            choices: [
                { text: "üòá Never", value: 3, karma: 5 },
                { text: "üòê Minor harm only", value: 2, karma: 0 },
                { text: "üòî Sometimes", value: 1, karma: -3 },
                { text: "üòà Frequently", value: 0, karma: -5 }
            ]
        },
        {
            text: "How do you treat others in need?",
            choices: [
                { text: "ü§ù Always help others", value: 3, karma: 5 },
                { text: "üôÇ Help when convenient", value: 2, karma: 2 },
                { text: "ü§∑ Rarely help", value: 1, karma: -2 },
                { text: "üö´ Avoid helping", value: 0, karma: -4 }
            ]
        }
    ];

    // Handle initial belief selection
    document.querySelectorAll('.choice-button').forEach(button => {
        button.addEventListener('click', (e) => {
            const choice = e.currentTarget.getAttribute('data-value');
            gameState.afterlifeCategory = choice;
            gameState.currentStep++;
            showNextQuestion();
        });
    });

    function showNextQuestion() {
        const questionContainer = document.getElementById('question-container');
        // Get questions based on selected path
        const pathQuestions = questionSets[gameState.afterlifeCategory] || [];
        const allQuestions = [...pathQuestions, ...universalQuestions];
        
        if (gameState.currentStep <= allQuestions.length) {
            const question = allQuestions[gameState.currentStep - 1];
            updateQuestionUI(question);
        } else {
            showOutcome();
        }
    }

    function updateQuestionUI(question) {
        const container = document.getElementById('question-container');
        const progressFill = document.querySelector('.progress-fill');
        const totalQuestions = Object.keys(questionImpacts).length;
        
        // Update progress bar
        progressFill.style.width = `${(gameState.currentStep / totalQuestions) * 100}%`;

        // Update question content
        container.innerHTML = `
            <h3>${question.question}</h3>
            <div class="outcome-image-container" style="position: relative;">
                <img id="questionImage" class="outcome-image" alt="Question visualization">
                <button class="refresh-image" onclick="refreshQuestionImage()">üîÑ</button>
            </div>
            <div class="choice-container">
                ${question.choices.map(choice => `
                    <button class="choice-button" data-impacts='${JSON.stringify(choice.impacts)}'>
                        ${choice.text}
                        <span class="tooltip">This choice will influence your spiritual journey</span>
                    </button>
                `).join('')}
            </div>
        `;

        // Generate new image for question
        generateQuestionImage(question);

        // Add click handlers to new buttons
        document.querySelectorAll('.choice-button').forEach(button => {
            button.addEventListener('click', () => {
                const impacts = JSON.parse(button.getAttribute('data-impacts'));
                updateScores({ impacts });
                gameState.currentStep++;
                
                if (gameState.currentStep >= Object.keys(questionImpacts).length) {
                    showOutcome();
                } else {
                    const nextQuestion = Object.values(questionImpacts)[gameState.currentStep];
                    updateQuestionUI(nextQuestion);
                }
            });
        });
    }

    function showOutcome() {
        const container = document.getElementById('question-container');
        const outcomes = calculateOutcome();
        
        container.innerHTML = `
            <div class="outcome-container">
                <h2 class="outcome-title">Your Afterlife Journey Unfolds...</h2>
                
                <div class="outcome-image-container">
                    <img id="outcomeImage" class="outcome-image" alt="Your afterlife visualization">
                    <button class="refresh-image" onclick="refreshOutcomeImage()">üîÑ</button>
                </div>

                <div class="belief-chart">
                    <h3>Your Spiritual Alignment</h3>
                    <div class="chart-container">
                        ${Object.entries(gameState.affinityScores).map(([belief, score]) => `
                            <div class="belief-bar">
                                <span class="belief-icon">${getBeliefIcon(belief)}</span>
                                <div class="belief-bar-container">
                                    <div class="belief-bar-fill" style="width: ${Math.max(0, Math.min(100, (score / 50) * 100))}%"></div>
                                </div>
                                <span class="belief-score">${Math.round(score)}</span>
                            </div>
                        `).join('')}
                    </div>
                </div>

                <div class="primary-outcome">
                    <h3>Primary Destiny</h3>
                    <div class="outcome-card primary">
                        <div class="outcome-header">
                            <span class="outcome-icon">${getBeliefIcon(outcomes.primary.belief)}</span>
                            <h4>${getBeliefName(outcomes.primary.belief)}</h4>
                        </div>
                        <p class="outcome-description">${outcomes.primary.outcome}</p>
                        <div class="outcome-aspects">
                            ${getBeliefAspects(outcomes.primary.belief, gameState.karmaScore)}
                        </div>
                    </div>
                </div>

                ${outcomes.secondary ? `
                    <div class="secondary-outcome">
                        <h3>Secondary Influence</h3>
                        <div class="outcome-card secondary">
                            <div class="outcome-header">
                                <span class="outcome-icon">${getBeliefIcon(outcomes.secondary.belief)}</span>
                                <h4>${getBeliefName(outcomes.secondary.belief)}</h4>
                            </div>
                            <p class="outcome-description">${outcomes.secondary.outcome}</p>
                            <div class="outcome-aspects">
                                ${getBeliefAspects(outcomes.secondary.belief, gameState.karmaScore)}
                            </div>
                        </div>
                    </div>
                ` : ''}

                <div class="spiritual-metrics">
                    <div class="metric-card karma">
                        <h4>Karma Balance</h4>
                        <div class="metric-value">
                            <span class="metric-icon">‚òØÔ∏è</span>
                            <span class="metric-level">${outcomes.karmaLevel}</span>
                        </div>
                        <div class="metric-bar">
                            <div class="metric-fill karma-fill" style="width: ${gameState.karmaScore}%"></div>
                        </div>
                        <p class="metric-description">${getKarmaDescription(gameState.karmaScore)}</p>
                    </div>

                    <div class="metric-card morality">
                        <h4>Moral Standing</h4>
                        <div class="metric-value">
                            <span class="metric-icon">‚öñÔ∏è</span>
                            <span class="metric-level">${outcomes.moralityLevel}</span>
                        </div>
                        <div class="metric-bar">
                            <div class="metric-fill morality-fill" style="width: ${gameState.moralityScore}%"></div>
                        </div>
                        <p class="metric-description">${getMoralityDescription(gameState.moralityScore)}</p>
                    </div>
                </div>

                <div class="final-insights">
                    <h3>Journey Insights</h3>
                    <div class="insights-content">
                        ${generateJourneyInsights(outcomes, gameState)}
                    </div>
                </div>

                <button class="restart-button" onclick="restartJourney()">Begin New Journey</button>
            </div>
        `;

        // Generate outcome image
        generateOutcomeImage(outcomes);

        // Add new styles
        const style = document.createElement('style');
        style.textContent = `
            .outcome-container {
                text-align: center;
                animation: fadeIn 0.5s ease;
            }

            .outcome-title {
                font-size: 2rem;
                margin-bottom: 2rem;
                color: #dc2626;
                text-shadow: 0 0 10px rgba(220, 38, 38, 0.3);
            }

            .belief-chart {
                background: #333;
                border-radius: 10px;
                padding: 1.5rem;
                margin: 2rem 0;
                border: 2px solid #dc2626;
            }

            .chart-container {
                display: grid;
                gap: 1rem;
                margin-top: 1rem;
            }

            .belief-bar {
                display: flex;
                align-items: center;
                gap: 1rem;
            }

            .belief-bar-container {
                flex: 1;
                height: 12px;
                background: #1a1a1a;
                border-radius: 6px;
                overflow: hidden;
            }

            .belief-bar-fill {
                height: 100%;
                background: #dc2626;
                transition: width 1s ease;
            }

            .belief-icon {
                font-size: 1.5rem;
                width: 40px;
                text-align: center;
            }

            .belief-score {
                width: 40px;
                text-align: right;
            }

            .outcome-card {
                background: #333;
                padding: 2rem;
                border-radius: 10px;
                margin: 1rem 0;
                border: 2px solid #dc2626;
                text-align: left;
            }

            .outcome-header {
                display: flex;
                align-items: center;
                gap: 1rem;
                margin-bottom: 1rem;
            }

            .outcome-icon {
                font-size: 2rem;
            }

            .outcome-aspects {
                display: grid;
                grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
                gap: 1rem;
                margin-top: 1.5rem;
                padding-top: 1.5rem;
                border-top: 1px solid #444;
            }

            .aspect-item {
                display: flex;
                align-items: start;
                gap: 0.5rem;
            }

            .aspect-icon {
                font-size: 1.2rem;
            }

            .spiritual-metrics {
                display: grid;
                grid-template-columns: 1fr 1fr;
                gap: 1.5rem;
                margin: 2rem 0;
            }

            .metric-card {
                background: #333;
                padding: 1.5rem;
                border-radius: 10px;
                border: 2px solid #dc2626;
            }

            .metric-value {
                display: flex;
                align-items: center;
                justify-content: center;
                gap: 1rem;
                margin: 1rem 0;
            }

            .metric-icon {
                font-size: 2rem;
            }

            .metric-level {
                font-size: 1.2rem;
                font-weight: bold;
            }

            .metric-bar {
                height: 10px;
                background: #1a1a1a;
                border-radius: 5px;
                overflow: hidden;
                margin: 1rem 0;
            }

            .metric-fill {
                height: 100%;
                transition: width 1s ease;
            }

            .karma-fill {
                background: linear-gradient(90deg, #dc2626, #4CAF50);
            }

            .morality-fill {
                background: linear-gradient(90deg, #dc2626, #2196F3);
            }

            .final-insights {
                background: #333;
                padding: 2rem;
                border-radius: 10px;
                margin: 2rem 0;
                border: 2px solid #dc2626;
                text-align: left;
            }

            .insights-content {
                display: grid;
                gap: 1rem;
                margin-top: 1rem;
            }

            .insight-item {
                display: flex;
                gap: 1rem;
                align-items: start;
                padding: 1rem;
                background: #2a2a2a;
                border-radius: 8px;
            }

            @keyframes fadeIn {
                from { opacity: 0; transform: translateY(20px); }
                to { opacity: 1; transform: translateY(0); }
            }
        `;
        document.head.appendChild(style);
    }

    function getBeliefName(belief) {
        const names = {
            abrahamic: 'Abrahamic Traditions',
            dharmic: 'Dharmic Paths',
            earthBased: 'Earth-Based Spirituality',
            philosophical: 'Philosophical Journey',
            atheistic: 'Rationalist Path',
            nihilistic: 'Void Understanding'
        };
        return names[belief] || belief;
    }

    function getBeliefAspects(belief, karmaScore) {
        const aspects = {
            abrahamic: [
                { icon: 'üôè', text: 'Divine Connection' },
                { icon: 'üìñ', text: 'Sacred Teachings' },
                { icon: 'üëº', text: 'Angelic Guidance' }
            ],
            dharmic: [
                { icon: '‚ò∏Ô∏è', text: 'Karmic Balance' },
                { icon: 'üßò', text: 'Spiritual Enlightenment' },
                { icon: 'üå∏', text: 'Inner Peace' }
            ],
            earthBased: [
                { icon: 'üå≥', text: 'Natural Harmony' },
                { icon: 'üåô', text: 'Elemental Connection' },
                { icon: 'üîÆ', text: 'Mystical Wisdom' }
            ],
            philosophical: [
                { icon: 'ü§î', text: 'Deep Understanding' },
                { icon: 'üìö', text: 'Wisdom Seeking' },
                { icon: 'üåü', text: 'Universal Truth' }
            ],
            atheistic: [
                { icon: 'üß™', text: 'Scientific Truth' },
                { icon: 'üåç', text: 'Natural Legacy' },
                { icon: 'ü§ù', text: 'Human Connection' }
            ],
            nihilistic: [
                { icon: 'üåå', text: 'Cosmic Insignificance' },
                { icon: 'üí´', text: 'Universal Void' },
                { icon: 'üé≠', text: 'Existential Freedom' }
            ]
        };

        return aspects[belief].map(aspect => `
            <div class="aspect-item">
                <span class="aspect-icon">${aspect.icon}</span>
                <span class="aspect-text">${aspect.text}</span>
            </div>
        `).join('');
    }

    function getKarmaDescription(karma) {
        if (karma >= 80) return "Your actions radiate profound positive energy";
        if (karma >= 60) return "Your journey shows mostly positive influence";
        if (karma >= 40) return "Your karma maintains a delicate balance";
        if (karma >= 20) return "Some actions weigh heavy on your spirit";
        return "Your path requires significant healing";
    }

    function getMoralityDescription(morality) {
        if (morality >= 80) return "You embody the highest ethical principles";
        if (morality >= 60) return "Your moral compass points true";
        if (morality >= 40) return "You walk a balanced ethical path";
        if (morality >= 20) return "Your choices often stray from virtue";
        return "Your moral journey needs reflection";
    }

    function generateJourneyInsights(outcomes, gameState) {
        const insights = [];
        
        // Add belief system insights
        insights.push(`
            <div class="insight-item">
                <span class="insight-icon">üåü</span>
                <div class="insight-text">
                    Your spiritual journey shows strongest resonance with ${getBeliefName(outcomes.primary.belief)}, 
                    ${outcomes.secondary ? `while being influenced by ${getBeliefName(outcomes.secondary.belief)}` : 
                    'with a unique and focused path'}.
                </div>
            </div>
        `);

        // Add karma insights
        insights.push(`
            <div class="insight-item">
                <span class="insight-icon">‚òØÔ∏è</span>
                <div class="insight-text">
                    ${getKarmaDescription(gameState.karmaScore)}. This will 
                    ${gameState.karmaScore >= 50 ? 'illuminate' : 'challenge'} your journey ahead.
                </div>
            </div>
        `);

        // Add special combinations insight
        if (outcomes.secondary) {
            insights.push(`
                <div class="insight-item">
                    <span class="insight-icon">üîÆ</span>
                    <div class="insight-text">
                        The combination of ${getBeliefName(outcomes.primary.belief)} and 
                        ${getBeliefName(outcomes.secondary.belief)} suggests a unique spiritual 
                        perspective that bridges multiple traditions.
                    </div>
                </div>
            `);
        }

        return insights.join('');
    }            ${getBeliefIcon(outcomes.secondary.belief)}
                            <p>${outcomes.secondary.outcome}</p>
                            <div class="affinity-bar">
                                <div class="affinity-fill" style="width: ${Math.min(100, (outcomes.secondary.score / 50) * 100)}%"></div>
                            </div>
                        </div>
                    </div>
                ` : ''}

                <div class="scores-container">
                    <div class="score-card">
                        <h4>Karma Level</h4>
                        <p>${outcomes.karmaLevel}</p>
                        <div class="karma-bar">
                            <div class="karma-fill" style="width: ${gameState.karmaScore}%"></div>
                        </div>
                    </div>

                    <div class="score-card">
                        <h4>Moral Standing</h4>
                        <p>${outcomes.moralityLevel}</p>
                        <div class="morality-bar">
                            <div class="morality-fill" style="width: ${gameState.moralityScore}%"></div>
                        </div>
                    </div>
                </div>

                <button class="restart-button" onclick="restartJourney()">Begin New Journey</button>
            </div>
        `;

        // Generate outcome image
        generateOutcomeImage(outcomes);

        // Add new styles
        const style = document.createElement('style');
        style.textContent = `
            .outcome-container {
                text-align: center;
            }

            .outcome-card {
                background: #333;
                padding: 1.5rem;
                border-radius: 10px;
                margin: 1rem 0;
                border: 2px solid #dc2626;
            }

            .affinity-bar, .karma-bar, .morality-bar {
                background: #1a1a1a;
                height: 10px;
                border-radius: 5px;
                margin-top: 1rem;
                overflow: hidden;
            }

            .affinity-fill {
                background: #dc2626;
                height: 100%;
                transition: width 1s ease;
            }

            .karma-fill {
                background: #4CAF50;
                height: 100%;
                transition: width 1s ease;
            }

            .morality-fill {
                background: #2196F3;
                height: 100%;
                transition: width 1s ease;
            }

            .scores-container {
                display: grid;
                grid-template-columns: 1fr 1fr;
                gap: 1rem;
                margin-top: 2rem;
            }

            .score-card {
                background: #333;
                padding: 1rem;
                border-radius: 10px;
                border: 2px solid #dc2626;
            }

            .restart-button {
                background: #dc2626;
                color: white;
                border: none;
                padding: 1rem 2rem;
                border-radius: 10px;
                margin-top: 2rem;
                cursor: pointer;
                font-size: 1.1rem;
                transition: transform 0.3s ease;
            }

            .restart-button:hover {
                transform: translateY(-2px);
            }
        `;
        document.head.appendChild(style);
    }

    function getBeliefIcon(belief) {
        const icons = {
            abrahamic: '‚úùÔ∏è',
            dharmic: '‚ò∏Ô∏è',
            earthBased: 'üåô',
            philosophical: 'ü§î',
            atheistic: '‚öõÔ∏è',
            nihilistic: 'üåå'
        };
        return icons[belief] || '‚ú®';
    }

    async function generateQuestionImage(question) {
        // Generate image based on question content
        const prompt = `Spiritual journey scene showing ${question.question} with mystical and ethereal elements, game art style`;
        await loadJourneyImage(true, prompt);
    }

    async function generateOutcomeImage(outcomes) {
        // Generate image based on primary outcome
        const prompt = `${outcomes.primary.outcome}, rendered as a spiritual journey destination with mystical elements and ethereal atmosphere, cinematic game art style`;
        await loadJourneyImage(true, prompt);
    }

    function restartJourney() {
        // Reset game state
        gameState.currentStep = 0;
        gameState.affinityScores = {
            abrahamic: 0,
            dharmic: 0,
            earthBased: 0,
            philosophical: 0,
            atheistic: 0,
            nihilistic: 0
        };
        gameState.karmaScore = 50;
        gameState.moralityScore = 50;
        gameState.answers = [];
        gameState.viableBeliefs = new Set(['abrahamic', 'dharmic', 'earthBased', 'philosophical', 'atheistic', 'nihilistic']);

        // Show first question
        const firstQuestion = Object.values(questionImpacts)[0];
        updateQuestionUI(firstQuestion);
    }

    function refreshQuestionImage() {
        const question = Object.values(questionImpacts)[gameState.currentStep];
        generateQuestionImage(question);
    }

    function refreshOutcomeImage() {
        const outcomes = calculateOutcome();
        generateOutcomeImage(outcomes);
    }
    </script>
</body>
</html>