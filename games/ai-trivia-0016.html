<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Trivia Challenge Game</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      background-color: #121212;
      color: #ffffff;
      margin: 0;
      padding: 0;
    }

    header {
      text-align: center;
      padding: 10px;
      background-color: #1e1e1e;
    }

    main {
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 20px;
      padding: 20px;
    }

    .game-container {
      width: 90%;
      max-width: 800px;
      border: 2px solid #333;
      border-radius: 8px;
      padding: 20px;
      background-color: #222;
    }

    .image-panel {
      position: relative;
      width: 100%;
      padding-top: 56.25%;
      background-color: #000;
      overflow: hidden;
      border-radius: 8px;
    }

    .image-panel img {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      object-fit: cover;
    }

    .overlay-text {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      font-size: 3em;
      font-weight: bold;
      color: rgba(255, 255, 255, 0.8);
      text-shadow: 2px 2px 5px black;
      display: none;
    }

    .overlay-text.correct {
      color: limegreen;
    }

    .overlay-text.incorrect {
      color: crimson;
    }

    .redo-icon {
      position: absolute;
      top: 10px;
      right: 10px;
      background-color: rgba(0, 0, 0, 0.7);
      color: white;
      border: none;
      padding: 5px 10px;
      cursor: pointer;
      border-radius: 50%;
      font-size: 1.2em;
    }

    .start-button {
      margin-top: 15px;
      padding: 10px 20px;
      font-size: 1.2em;
      color: white;
      background-color: #007bff;
      border: none;
      border-radius: 5px;
      cursor: pointer;
      opacity: 0.5;
    }

    .start-button.ready {
      opacity: 1;
      cursor: pointer;
    }

    .start-button:disabled {
      cursor: not-allowed;
    }

    .text-area {
      margin-top: 20px;
      height: 100px;
      overflow-y: auto;
      border: 1px solid #333;
      padding: 10px;
      background-color: #181818;
      border-radius: 5px;
    }

    .input-area {
      margin-top: 10px;
      display: flex;
      gap: 10px;
    }

    .input-area input {
      flex: 1;
      padding: 10px;
      border: 1px solid #555;
      border-radius: 5px;
      background-color: #333;
      color: #fff;
    }

    .input-area button {
      padding: 10px;
      border: none;
      border-radius: 5px;
      background-color: #444;
      color: #fff;
      cursor: pointer;
      opacity: 0.5;
    }

    .input-area button.ready {
      opacity: 1;
      cursor: pointer;
    }

    .input-area button:disabled {
      cursor: not-allowed;
    }

    .points {
      font-size: 1.2em;
      text-align: center;
    }

    .hidden {
      display: none !important;
    }

    #intro-text {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      text-align: center;
      color: white;
      text-shadow: 2px 2px 4px rgba(0,0,0,0.8);
      font-size: 1.5em;
      width: 80%;
    }
  </style>
</head>
<body>
  <header>
    <h1>Trivia Challenge Game</h1>
  </header>
  <main>
    <div class="game-container">
      <div class="image-panel">
        <img id="ai-image" src="" alt="Game Screen" />
        <div id="intro-text">
          Welcome to Trivia Challenge!<br><br>
          Test your knowledge across various topics.<br>
          Answer questions correctly to earn points.<br>
          Images will help reveal the answers.<br><br>
          Are you ready to begin?
        </div>
        <div id="overlay-text" class="overlay-text"></div>
        <button class="redo-icon hidden" id="redo-button">‚ü≥</button>
      </div>

      <button class="start-button" id="start-button" disabled>Start Game</button>
      <div class="points" id="points-container">Points: <span id="points">0</span></div>
      <div class="text-area" id="text-area"></div>
      <div class="input-area hidden" id="input-container">
        <input type="text" id="user-input" placeholder="Your answer..." />
        <button id="send-button" disabled>Send</button>
      </div>
      <button id="reset-button">Reset Game</button>
    </div>
  </main>

  <script>
    let points = 0;
    let questionList = [];
    let imageList = [];
    let currentQuestionIndex = 0;
    let imageCache = new Map();
    let isIntroLoaded = false;
    let currentImageLoading = false;
    let nextQuestionsLoading = false;

    const aiImage = document.getElementById("ai-image");
    const overlayText = document.getElementById("overlay-text");
    const textArea = document.getElementById("text-area");
    const pointsDisplay = document.getElementById("points");
    const startButton = document.getElementById("start-button");
    const redoButton = document.getElementById("redo-button");
    const inputContainer = document.getElementById("input-container");
    const pointsContainer = document.getElementById("points-container");
    const resetButton = document.getElementById("reset-button");
    const userInput = document.getElementById("user-input");
    const sendButton = document.getElementById("send-button");
    const introText = document.getElementById("intro-text");

    function initializeUI() {
        startButton.disabled = false;
        startButton.classList.add('ready');
        redoButton.classList.remove("hidden");
        inputContainer.classList.add("hidden");
        points = 0;
        pointsDisplay.textContent = "0";
        userInput.value = "";
    }

    const getRandomSeed = () => Math.floor(Math.random() * 100000);

    async function loadAndCacheImage(url) {
        if (imageCache.has(url)) {
            return imageCache.get(url);
        }
        
        try {
            const response = await fetch(url);
            if (response.ok) {
                const blob = await response.blob();
                const objectUrl = URL.createObjectURL(blob);
                imageCache.set(url, objectUrl);
                return objectUrl;
            }
        } catch (error) {
            console.error("Failed to load image:", error);
        }
        return null;
    }

	async function fetchIntroImage() {
		const seed = getRandomSeed();
		const prompt = "COLORFUL VIVID TYPOGRAPHIC_STYLE READS 'TRIVIA CHALLENGE'";
		const url = `https://image.pollinations.ai/prompt/${encodeURIComponent(prompt)}?nologo=true&enhance=false&private=true&width=1920&height=1080&model=flux&seed=${seed}`;
		
		const cachedImageUrl = await loadAndCacheImage(url);
		if (cachedImageUrl) {
			aiImage.src = cachedImageUrl;
			isIntroLoaded = true;
			startButton.disabled = false;
			startButton.classList.add('ready');
		}
	}

    async function fetchAIQuestions(theme) {
        const seed = getRandomSeed();
        const prompt = `Generate 10 trivia questions about ${theme}. Return only the questions, no explanations or comments.`;
        const url = `https://text.pollinations.ai/${encodeURIComponent(prompt)}?seed=${seed}`;
        try {
            const response = await fetch(url);
            return (await response.text()).split("\n").filter((q) => q.trim());
        } catch (error) {
            console.error("Error fetching trivia questions:", error);
            return [];
        }
    }

    async function fetchAnswerImage(answer) {
        if (currentImageLoading) return null;
        currentImageLoading = true;

        const seed = getRandomSeed();
        const prompt = `A visual representation of the answer: ${answer}`;
        const url = `https://image.pollinations.ai/prompt/${encodeURIComponent(prompt)}?nologo=true&enhance=false&private=true&width=1920&height=1080&model=flux&seed=${seed}`;
        
        const cachedImageUrl = await loadAndCacheImage(url);
        currentImageLoading = false;
        return cachedImageUrl;
    }

    async function prefetchNextImages() {
        const remainingQuestions = questionList.length - currentQuestionIndex;
        const prefetchCount = Math.min(3, remainingQuestions);
        
        for (let i = currentQuestionIndex + 1; i < currentQuestionIndex + prefetchCount; i++) {
            const answer = questionList[i];
            if (answer && !imageCache.has(answer)) {
                fetchAnswerImage(answer);
            }
        }
    }

    async function startGame() {
        if (!isIntroLoaded) return;
        
        startButton.disabled = true;
        introText.style.display = 'none';
        textArea.textContent = "Loading questions...";

        const theme = "general trivia";
        questionList = await fetchAIQuestions(theme);
        
        if (questionList.length === 0) {
            textArea.textContent = "Error loading questions. Please try again.";
            return;
        }

        inputContainer.classList.remove("hidden");
        startButton.classList.add("hidden");
        displayNextQuestion();
    }

    async function displayNextQuestion() {
        if (currentQuestionIndex < questionList.length) {
            const question = questionList[currentQuestionIndex];
            textArea.textContent = `Question ${currentQuestionIndex + 1}: ${question}`;
            userInput.value = "";
            sendButton.disabled = true;
            sendButton.classList.remove('ready');

            // Start loading the answer image
            const imageUrl = await fetchAnswerImage(questionList[currentQuestionIndex]);
            if (imageUrl) {
                aiImage.src = imageUrl;
                sendButton.disabled = false;
                sendButton.classList.add('ready');
            }

            // Prefetch next images while user is answering
            prefetchNextImages();

            // If we're near the end, start loading more questions
            if (currentQuestionIndex >= questionList.length - 3 && !nextQuestionsLoading) {
                nextQuestionsLoading = true;
                const newQuestions = await fetchAIQuestions("general trivia");
                questionList = [...questionList, ...newQuestions];
                nextQuestionsLoading = false;
            }
        } else {
            textArea.textContent = "Game Over! Final Score: " + points;
            inputContainer.classList.add("hidden");
            resetButton.classList.remove("hidden");
        }
    }

    function checkAnswer() {
        if (sendButton.disabled) return;

        const userInputValue = userInput.value.trim();
        const correctAnswer = questionList[currentQuestionIndex];
        const isCorrect = userInputValue.toLowerCase() === correctAnswer.toLowerCase();

        overlayText.textContent = isCorrect ? "CORRECT!" : "INCORRECT";
        overlayText.className = `overlay-text ${isCorrect ? "correct" : "incorrect"}`;
        overlayText.style.display = "block";

        textArea.textContent = `The correct answer was: ${correctAnswer}`;

        points += isCorrect ? 1 : 0;
        pointsDisplay.textContent = points;

        sendButton.disabled = true;
        sendButton.classList.remove('ready');
        userInput.disabled = true;

        setTimeout(() => {
            overlayText.style.display = "none";
            userInput.disabled = false;
            currentQuestionIndex++;
            displayNextQuestion();
        }, 2000);
    }

    sendButton.addEventListener("click", checkAnswer);

    userInput.addEventListener("keypress", (event) => {
        if (event.key === "Enter" && !sendButton.disabled) {
            checkAnswer();
        }
    });

    userInput.addEventListener("input", () => {
        if (userInput.value.trim() && !sendButton.disabled) {
            sendButton.classList.add('ready');
        } else {
            sendButton.classList.remove('ready');
        }
    });

    startButton.addEventListener("click", startGame);

    resetButton.addEventListener("click", () => {
        location.reload();
    });

	redoButton.addEventListener("click", fetchIntroImage);

	window.onload = () => {
		initializeUI();
		fetchIntroImage();
	};
  </script>
</body>
</html>