const init = () => {
    const GRID_SIZE = 4;
    const TOTAL_TILES = GRID_SIZE * GRID_SIZE;
    let currentPosition = 0;
    
    // Create grid container
    const gridContainer = document.createElement('div');
    gridContainer.style.cssText = `
        width: 100%;
        max-width: 600px;
        margin: 20px auto;
        display: grid;
        grid-template-columns: repeat(4, 1fr);
        grid-template-rows: repeat(4, 1fr);
        gap: 4px;
        background: #1a1a1a;
        padding: 8px;
        border-radius: 8px;
        aspect-ratio: 1;
    `;
    document.body.appendChild(gridContainer);

    // Create grid tiles
    const tiles = [];
    for (let i = 0; i < TOTAL_TILES; i++) {
        const tile = document.createElement('div');
        tile.style.cssText = `
            width: 100%;
            padding-bottom: 100%;
            background: #2a2a2a;
            border-radius: 4px;
            overflow: hidden;
            position: relative;
        `;
        const img = document.createElement('img');
        img.style.cssText = `
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            object-fit: cover;
        `;
        tile.appendChild(img);
        gridContainer.appendChild(tile);
        tiles.push(tile);
    }

    // Connect to feed
    const evtSource = new EventSource('https://image.pollinations.ai/feed?past_results=0');

    evtSource.onmessage = function(event) {
        try {
            const data = JSON.parse(event.data);
            if (!data.imageURL) return;
            
            // Display image in next position
            const tile = tiles[currentPosition];
            const img = tile.querySelector('img');
            img.src = data.imageURL;
            
            // Move to next position, wrap around if needed
            currentPosition = (currentPosition + 1) % TOTAL_TILES;
            
        } catch (e) {
            console.error('Error:', e);
        }
    };
};

if (document.readyState === 'loading') {
    document.addEventListener('DOMContentLoaded', init);
} else {
    init();
}