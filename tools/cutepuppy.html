<!DOCTYPE html>
<html>
<head>
    <title>Puppy Rating</title>
    <style>
		body {
			font-family: 'Comic Sans MS', 'Helvetica Neue', Arial, sans-serif;
			max-width: 800px;
			margin: 0 auto;
			padding: 20px;
			background-color: #fcf8e8;
			color: #5c4f67;
			line-height: 1.6;
		}

		h1, h2 {
			color: #d18ec2;
			text-align: center;
		}

		p {
			margin: 15px 0;
		}

		#fileInput {
			display: block;
			margin: 20px auto;
			padding: 10px;
			border: 2px dashed #a6d8f1;
			border-radius: 15px;
			background-color: #e9f7ff;
			width: 80%;
			cursor: pointer;
		}

		#fileInput::file-selector-button {
			background: #a6d8f1;
			border: none;
			padding: 8px 16px;
			border-radius: 25px;
			color: #5c4f67;
			font-weight: bold;
			cursor: pointer;
			transition: all 0.3s;
		}

		#fileInput::file-selector-button:hover {
			background: #89c4e8;
		}

		#thumbnails {
			display: flex;
			overflow-x: auto;
			gap: 15px;
			padding: 15px;
			background: #fde9f4;
			margin: 20px 0;
			border-radius: 15px;
			box-shadow: 0 2px 5px rgba(0,0,0,0.1);
		}

		.thumbnail {
			width: 70px;
			height: 70px;
			object-fit: cover;
			cursor: pointer;
			border-radius: 10px;
			transition: transform 0.2s;
			box-shadow: 0 2px 4px rgba(0,0,0,0.1);
		}

		.thumbnail:hover {
			transform: scale(1.1);
		}

		.thumbnail.active {
			border: 3px solid #ff8dbd;
			box-shadow: 0 0 10px #ff8dbd;
		}

		.meter {
			margin: 15px 0;
			background: #e6e6fa;
			height: 25px;
			border-radius: 15px;
			box-shadow: inset 0 2px 5px rgba(0,0,0,0.1);
		}

		.meter-fill {
			height: 100%;
			background: linear-gradient(to right, #ffb8e7, #a6d8f1);
			border-radius: 15px;
			transition: width 0.5s ease-in-out;
		}

		#preview {
			display: block;
			max-width: 400px;
			max-height: 400px;
			margin: 20px auto;
			border-radius: 15px;
			box-shadow: 0 5px 15px rgba(0,0,0,0.1);
		}

		#result {
			background-color: #fef4f8;
			padding: 20px;
			border-radius: 15px;
			box-shadow: 0 3px 10px rgba(0,0,0,0.1);
			text-align: center;
			margin-top: 20px;
		}

		/* Add paw print cursor */
		body, button, input[type="file"] {
			cursor: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"><path fill="%23d18ec2" d="M12,8.5A1.5,1.5 0 0,1 10.5,7A1.5,1.5 0 0,1 12,5.5A1.5,1.5 0 0,1 13.5,7A1.5,1.5 0 0,1 12,8.5M9,6A1.5,1.5 0 0,1 7.5,4.5A1.5,1.5 0 0,1 9,3A1.5,1.5 0 0,1 10.5,4.5A1.5,1.5 0 0,1 9,6M15,6A1.5,1.5 0 0,1 13.5,4.5A1.5,1.5 0 0,1 15,3A1.5,1.5 0 0,1 16.5,4.5A1.5,1.5 0 0,1 15,6M9,13A1.5,1.5 0 0,1 7.5,11.5A1.5,1.5 0 0,1 9,10A1.5,1.5 0 0,1 10.5,11.5A1.5,1.5 0 0,1 9,13M15,13A1.5,1.5 0 0,1 13.5,11.5A1.5,1.5 0 0,1 15,10A1.5,1.5 0 0,1 16.5,11.5A1.5,1.5 0 0,1 15,13Z" /></svg>') 10 10, auto;
		}
    </style>
</head>
<body>
    <h1>Puppy Cuteness Meter</h1>
    <p>Upload or paste a puppy photo:</p>
    <input type="file" id="fileInput" accept="image/*">
    <div id="thumbnails" style="display: none;"></div>
    <div id="result"></div>

    <script>
        let currentImage = null;
        let allImages = [];
        
        // Setup paste handler
        document.addEventListener('paste', function(e) {
            const items = e.clipboardData.items;
            for (let i = 0; i < items.length; i++) {
                if (items[i].type.indexOf('image') !== -1) {
                    const blob = items[i].getAsFile();
                    handleImage(blob);
                    break;
                }
            }
        });
        
        // Setup file input
        document.getElementById('fileInput').addEventListener('change', function(e) {
            if (e.target.files.length > 0) {
                handleImage(e.target.files[0]);
            }
        });
        
        // Process image
        function handleImage(file) {
            const reader = new FileReader();
            reader.onload = function(e) {
                const imgData = e.target.result;
                currentImage = imgData.split(',')[1]; // Just the base64 part
                
                // Add to thumbnails
                addToThumbnails(imgData);
                
                // Process with AI
                analyzeImage(currentImage);
            };
            reader.readAsDataURL(file);
        }
        
        // Add image to thumbnails bar
        function addToThumbnails(imgData) {
            // Add to array
            allImages.push(imgData);
            
            // Update thumbnails UI
            const thumbnailsBar = document.getElementById('thumbnails');
            thumbnailsBar.style.display = 'flex';
            thumbnailsBar.innerHTML = '';
            
            allImages.forEach((img, index) => {
                const thumb = document.createElement('img');
                thumb.src = img;
                thumb.className = 'thumbnail';
                if (img.split(',')[1] === currentImage) {
                    thumb.classList.add('active');
                }
                thumb.onclick = function() {
                    currentImage = img.split(',')[1];
                    analyzeImage(currentImage);
                    // Update active state
                    document.querySelectorAll('.thumbnail').forEach(t => t.classList.remove('active'));
                    thumb.classList.add('active');
                };
                thumbnailsBar.appendChild(thumb);
            });
        }
        
        // Analyze image with AI
        async function analyzeImage(base64Image) {
            // Show loading state
            document.getElementById('result').innerHTML = '<p>Analyzing puppy...</p>';
            
            try {
                // Modified to use text mode instead of JSON mode to avoid parsing issues
                const response = await fetch('https://text.pollinations.ai/', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        model: "openai",
                        jsonMode: false, // Changed to false for simplicity
                        messages: [
                            {
                                role: 'system',
                                content: "You are a Puppy Cuteness Meter. Rate puppies on a scale of 1-10. Your response MUST include the exact phrase 'Cuteness Rating: X/10' where X is a number between 1 and 10. Then provide a brief 1-3 sentence description of the puppy. If image doesn't show a puppy, say so and ask for a puppy photo."
                            },
                            {
                                role: 'user',
                                content: [
                                    { type: 'text', text: "Rate this puppy's cuteness from 1-10:" },
                                    { type: 'image_url', image_url: { url: `data:image/jpeg;base64,${base64Image}` } }
                                ]
                            }
                        ]
                    })
                });
                
                let responseData = await response.text(); // Get as text first
                console.log("Raw response:", responseData);
                
                try {
                    // Try to parse as JSON first
                    const data = JSON.parse(responseData);
                    responseData = data.choices?.[0]?.message?.content || responseData;
                } catch (e) {
                    console.log("Not valid JSON, using as is:", e);
                    // If not valid JSON, use as is
                }
                
                // Extract rating using regex
                const ratingMatch = responseData.match(/Cuteness Rating:\s*(\d+)/i);
                const rating = ratingMatch ? parseInt(ratingMatch[1]) : 7; // Default to 7 if not found
                
                // Extract description - everything after the rating line
                let description = responseData;
                if (ratingMatch) {
                    const ratingIndex = responseData.indexOf(ratingMatch[0]);
                    description = responseData.substring(ratingIndex + ratingMatch[0].length).trim();
                }
                
                // Create result HTML
                const resultHTML = `
                    <img src="data:image/jpeg;base64,${base64Image}" id="preview">
                    <h2>Cuteness Rating: ${rating}/10</h2>
                    <p>${description}</p>
                    <div>
                        <strong>Cuteness Meter:</strong>
                        <div class="meter">
                            <div class="meter-fill" style="width: ${rating*10}%;"></div>
                        </div>
                    </div>
                `;
                
                document.getElementById('result').innerHTML = resultHTML;
                
            } catch (error) {
                console.error('Error:', error);
                document.getElementById('result').innerHTML = `
                    <p>Error analyzing image: ${error.message}</p>
                    <img src="data:image/jpeg;base64,${base64Image}" id="preview">
                `;
            }
        }
		
		// Clear file input on page load
		window.addEventListener('load', function() {
			document.getElementById('fileInput').value = '';
			document.getElementById('thumbnails').style.display = 'none';
			document.getElementById('result').innerHTML = '';
		});		
    </script>
</body>
</html>
