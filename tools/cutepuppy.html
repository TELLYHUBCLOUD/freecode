<!DOCTYPE html>
<html>
<head>
    <title>Puppy Rating</title>
    <style>
        body { font-family: Arial; max-width: 800px; margin: 0 auto; padding: 20px; }
        #thumbnails { display: flex; overflow-x: auto; gap: 10px; padding: 10px; background: #f0f0f0; margin: 10px 0; }
        .thumbnail { width: 70px; height: 70px; object-fit: cover; cursor: pointer; }
        .thumbnail.active { border: 3px solid red; }
        .meter { margin: 10px 0; background: #eee; height: 20px; border-radius: 10px; }
        .meter-fill { height: 100%; background: linear-gradient(to right, red, purple); border-radius: 10px; }
        #preview { max-width: 400px; margin: 20px 0; }
    </style>
</head>
<body>
    <h1>Puppy Cuteness Meter</h1>
    <p>Upload or paste a puppy photo:</p>
    <input type="file" id="fileInput" accept="image/*">
    <div id="thumbnails" style="display: none;"></div>
    <div id="result"></div>

    <script>
        let currentImage = null;
        let allImages = [];
        
        // Setup paste handler
        document.addEventListener('paste', function(e) {
            const items = e.clipboardData.items;
            for (let i = 0; i < items.length; i++) {
                if (items[i].type.indexOf('image') !== -1) {
                    const blob = items[i].getAsFile();
                    handleImage(blob);
                    break;
                }
            }
        });
        
        // Setup file input
        document.getElementById('fileInput').addEventListener('change', function(e) {
            if (e.target.files.length > 0) {
                handleImage(e.target.files[0]);
            }
        });
        
        // Process image
        function handleImage(file) {
            const reader = new FileReader();
            reader.onload = function(e) {
                const imgData = e.target.result;
                currentImage = imgData.split(',')[1]; // Just the base64 part
                
                // Add to thumbnails
                addToThumbnails(imgData);
                
                // Process with AI
                analyzeImage(currentImage);
            };
            reader.readAsDataURL(file);
        }
        
        // Add image to thumbnails bar
        function addToThumbnails(imgData) {
            // Add to array
            allImages.push(imgData);
            
            // Update thumbnails UI
            const thumbnailsBar = document.getElementById('thumbnails');
            thumbnailsBar.style.display = 'flex';
            thumbnailsBar.innerHTML = '';
            
            allImages.forEach((img, index) => {
                const thumb = document.createElement('img');
                thumb.src = img;
                thumb.className = 'thumbnail';
                if (img.split(',')[1] === currentImage) {
                    thumb.classList.add('active');
                }
                thumb.onclick = function() {
                    currentImage = img.split(',')[1];
                    analyzeImage(currentImage);
                    // Update active state
                    document.querySelectorAll('.thumbnail').forEach(t => t.classList.remove('active'));
                    thumb.classList.add('active');
                };
                thumbnailsBar.appendChild(thumb);
            });
        }
        
        // Analyze image with AI
        async function analyzeImage(base64Image) {
            // Show loading state
            document.getElementById('result').innerHTML = '<p>Analyzing puppy...</p>';
            
            try {
                const response = await fetch('https://text.pollinations.ai/', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        model: "openai-large",
                        messages: [
                            {
                                role: 'system',
                                content: "You are a Puppy Cuteness Meter. Rate puppies on a scale of 1-10. ALWAYS include 'Cuteness Score: X/10' in your response where X is the rating. Describe the puppy briefly. If image doesn't show a puppy, kindly say so and ask for a puppy photo instead."
                            },
                            {
                                role: 'user',
                                content: [
                                    { type: 'text', text: "Rate this puppy's cuteness from 1-10:" },
                                    { type: 'image_url', image_url: { url: `data:image/jpeg;base64,${base64Image}` } }
                                ]
                            }
                        ]
                    })
                });
                
                const data = await response.json();
                const result = data.choices?.[0]?.message?.content || "Error analyzing image";
                
                // Extract score
                const scoreMatch = result.match(/Cuteness Score:\s*(\d+)/i);
                const score = scoreMatch ? parseInt(scoreMatch[1]) : 0;
                
                // Create result HTML
                const resultHTML = `
                    <img src="data:image/jpeg;base64,${base64Image}" id="preview">
                    <div>${result}</div>
                    <div>
                        <strong>Cuteness Meter:</strong>
                        <div class="meter">
                            <div class="meter-fill" style="width: ${score*10}%;"></div>
                        </div>
                    </div>
                `;
                
                document.getElementById('result').innerHTML = resultHTML;
                
            } catch (error) {
                console.error('Error:', error);
                document.getElementById('result').innerHTML = '<p>Error analyzing image. Please try again.</p>';
            }
        }
    </script>
</body>
</html>
