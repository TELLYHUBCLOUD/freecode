<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Relationship Preference Finder</title>
    <style>
        :root {
            --primary: #8a2be2;
            --primary-light: #9d44e6;
            --background: #121212;
            --surface: #1e1e1e;
            --text: #e0e0e0;
            --text-secondary: #a0a0a0;
            --accent: #ff6b6b;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: var(--background);
            color: var(--text);
            margin: 0;
            padding: 0;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
        }
        
        .container {
            width: 90%;
            max-width: 800px;
            margin: 2rem auto;
            padding: 2rem;
            background-color: var(--surface);
            border-radius: 12px;
            box-shadow: 0 8px 16px rgba(0, 0, 0, 0.3);
        }
        
        h1 {
            text-align: center;
            color: var(--primary);
            margin-bottom: 2rem;
        }
        
        .intro {
            text-align: center;
            margin-bottom: 2rem;
            line-height: 1.6;
        }
        
        .question-container {
            display: none;
            animation: fadeIn 0.5s ease-in;
            margin-bottom: 2rem;
        }
        
        .question-container.active {
            display: block;
        }
        
        .question {
            font-size: 1.2rem;
            margin-bottom: 1.5rem;
            text-align: center;
        }
        
        .options {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: 1rem;
            margin-bottom: 2rem;
        }
        
        .option {
            background-color: var(--surface);
            border: 2px solid var(--primary);
            border-radius: 8px;
            padding: 0.8rem 1.5rem;
            cursor: pointer;
            transition: all 0.3s ease;
            color: var(--text);
            font-size: 1rem;
        }
        
        .option:hover {
            background-color: var(--primary-light);
            transform: translateY(-3px);
        }
        
        .option.selected {
            background-color: var(--primary);
            color: white;
            transform: translateY(-3px);
            box-shadow: 0 4px 8px rgba(138, 43, 226, 0.3);
        }
        
        .controls {
            display: flex;
            justify-content: space-between;
            margin-top: 2rem;
        }
        
        button {
            background-color: var(--primary);
            color: white;
            border: none;
            border-radius: 30px;
            padding: 0.8rem 1.8rem;
            font-size: 1rem;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
        }
        
        button:hover {
            background-color: var(--primary-light);
            transform: translateY(-2px);
        }
        
        button:disabled {
            background-color: var(--text-secondary);
            cursor: not-allowed;
            transform: none;
        }
        
        #prevBtn {
            visibility: hidden;
        }
        
        .progress-bar {
            height: 6px;
            background-color: #333;
            border-radius: 3px;
            margin: 2rem 0;
            overflow: hidden;
        }
        
        .progress {
            height: 100%;
            background-color: var(--primary);
            transition: width 0.3s ease;
        }
        
        #results {
            display: none;
            animation: fadeIn 0.8s ease-in;
        }
        
        .result-card {
            background-color: rgba(138, 43, 226, 0.1);
            border-radius: 10px;
            padding: 1.5rem;
            margin-bottom: 1.5rem;
            border-left: 4px solid var(--primary);
        }
        
        .result-title {
            font-size: 1.3rem;
            color: var(--primary);
            margin-bottom: 1rem;
        }
        
        .restart-btn {
            display: block;
            margin: 2rem auto;
            background-color: var(--accent);
        }
        
        .restart-btn:hover {
            background-color: #ff8787;
        }
        
        .loading {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            margin: 2rem 0;
        }
        
        .spinner {
            border: 4px solid rgba(0, 0, 0, 0.1);
            width: 36px;
            height: 36px;
            border-radius: 50%;
            border-left-color: var(--primary);
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .ai-insight {
            background: linear-gradient(135deg, rgba(138, 43, 226, 0.15) 0%, rgba(138, 43, 226, 0.05) 100%);
            border-radius: 12px;
            padding: 1.5rem;
            margin: 2rem 0;
            border-left: 4px solid var(--primary);
            position: relative;
        }
        
        .ai-badge {
            position: absolute;
            top: -10px;
            right: -10px;
            background-color: var(--primary);
            color: white;
            font-size: 0.7rem;
            padding: 0.2rem 0.5rem;
            border-radius: 4px;
        }
        
        .share-options {
            margin-top: 2rem;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 1rem;
        }
        
        .share-link {
            background-color: var(--primary);
            color: white;
            text-decoration: none;
            padding: 0.8rem 1.5rem;
            border-radius: 30px;
            display: flex;
            align-items: center;
            gap: 0.5rem;
            font-size: 0.9rem;
        }
        
        .share-link:hover {
            background-color: var(--primary-light);
        }
        
        .share-image {
            width: 100%;
            margin-top: 1rem;
            border-radius: 10px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
            max-width: 500px;
        }
        
        .copy-btn {
            background-color: var(--surface);
            border: 1px solid var(--primary);
            color: var(--text);
            padding: 0.5rem 1rem;
            border-radius: 4px;
            cursor: pointer;
            font-size: 0.9rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }
        
        #shareUrl {
            width: 100%;
            padding: 0.8rem;
            background-color: var(--background);
            color: var(--text);
            border: 1px solid #333;
            border-radius: 4px;
            font-size: 0.9rem;
            margin-bottom: 0.5rem;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        /* Responsive adjustments */
        @media (max-width: 600px) {
            .container {
                padding: 1.5rem;
                width: 95%;
            }
            
            .options {
                flex-direction: column;
                gap: 0.7rem;
            }
            
            .option {
                width: 100%;
                text-align: center;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>Relationship Preference Finder</h1>
        
        <div id="intro" class="intro">
            <p>Not sure what kind of relationship you're looking for? This quiz will help you clarify your preferences and understand what you really want.</p>
            <p>Answer honestly - this is just for your own clarity!</p>
            <button id="startBtn">Let's Get Started</button>
        </div>
        
        <div id="quiz" style="display: none;">
            <div class="progress-bar">
                <div id="progress" class="progress" style="width: 0%;"></div>
            </div>

			<div id="question0a" class="question-container active">
				<div class="question">What is your gender identity?</div>
				<div class="options">
					<div class="option" data-value="woman">Woman</div>
					<div class="option" data-value="man">Man</div>
					<div class="option" data-value="non-binary">Non-binary</div>
					<div class="option" data-value="other">Other/Prefer not to say</div>
				</div>
			</div>

			<div id="question0b" class="question-container">
				<div class="question">What gender(s) are you interested in connecting with?</div>
				<div class="options">
					<div class="option" data-value="women">Women</div>
					<div class="option" data-value="men">Men</div>
					<div class="option" data-value="all-genders">People of all genders</div>
					<div class="option" data-value="prefer-not-say">Prefer not to specify</div>
				</div>
			</div>
            
            <div id="question1" class="question-container active">
                <div class="question">When you think about connecting with someone, what's most important to you?</div>
                <div class="options">
                    <div class="option" data-value="friendship">Genuine friendship and connection</div>
                    <div class="option" data-value="casual">Fun, light-hearted interactions</div>
                    <div class="option" data-value="romantic">Deep emotional intimacy</div>
                    <div class="option" data-value="physical">Physical chemistry and attraction</div>
                </div>
            </div>
            
            <div id="question2" class="question-container">
                <div class="question">How do you prefer to spend time with someone you're interested in?</div>
                <div class="options">
                    <div class="option" data-value="virtual">Mostly virtual (texts, calls, video chats)</div>
                    <div class="option" data-value="casual-meetups">Casual in-person hangouts</div>
                    <div class="option" data-value="planned-dates">Planned, intentional dates</div>
                    <div class="option" data-value="travel">Traveling and experiencing new places together</div>
                </div>
            </div>
            
            <div id="question3" class="question-container">
                <div class="question">When it comes to flirting and romantic interaction, you prefer:</div>
                <div class="options">
                    <div class="option" data-value="none">Minimal to none - I value platonic connections</div>
                    <div class="option" data-value="light">Light, playful flirting but nothing serious</div>
                    <div class="option" data-value="moderate">Moderate flirting with some romantic gestures</div>
                    <div class="option" data-value="intense">Intense romantic and passionate interactions</div>
                </div>
            </div>
            
            <div id="question4" class="question-container">
                <div class="question">How important is geographic proximity in your relationships?</div>
                <div class="options">
                    <div class="option" data-value="local">Must be local - I want regular in-person interaction</div>
                    <div class="option" data-value="driving">Within driving distance is fine</div>
                    <div class="option" data-value="long-distance">Open to long-distance with occasional visits</div>
                    <div class="option" data-value="anywhere">Location doesn't matter to me</div>
                </div>
            </div>
            
            <div id="question5" class="question-container">
                <div class="question">When it comes to commitment and exclusivity, you're looking for:</div>
                <div class="options">
                    <div class="option" data-value="open">Complete openness to see others</div>
                    <div class="option" data-value="casual">Casual but respectful - no labels needed</div>
                    <div class="option" data-value="exclusive-casual">Exclusive but still keeping it light</div>
                    <div class="option" data-value="committed">Dedicated, committed relationship</div>
                </div>
            </div>
            
            <div id="question6" class="question-container">
                <div class="question">How fast do you typically want a relationship to progress?</div>
                <div class="options">
                    <div class="option" data-value="slow">Slowly - I need time to build trust</div>
                    <div class="option" data-value="moderate">At a moderate, natural pace</div>
                    <div class="option" data-value="fast">Relatively quickly if there's chemistry</div>
                    <div class="option" data-value="varies">It varies depending on the connection</div>
                </div>
            </div>
            
            <div id="question7" class="question-container">
                <div class="question">How important is physical intimacy in your ideal relationship?</div>
                <div class="options">
                    <div class="option" data-value="not-important">Not important or not a priority</div>
                    <div class="option" data-value="somewhat">Somewhat important, but not central</div>
                    <div class="option" data-value="important">Very important for compatibility</div>
                    <div class="option" data-value="essential">Essential and a primary focus</div>
                </div>
            </div>
            
            <div id="question8" class="question-container">
                <div class="question">How do you feel about integrating a new relationship into your life?</div>
                <div class="options">
                    <div class="option" data-value="separate">I prefer to keep it separate from my everyday life</div>
                    <div class="option" data-value="casual-integration">Some casual integration is fine</div>
                    <div class="option" data-value="significant">Significant integration into my social circle</div>
                    <div class="option" data-value="complete">Complete integration into all aspects of life</div>
                </div>
            </div>
            
            <div class="controls">
                <button id="prevBtn">Previous</button>
                <button id="nextBtn">Next</button>
            </div>
        </div>
        
        <div id="results" style="display: none;">
            <h2>Your Relationship Preference Profile</h2>
            
            <div class="result-card">
                <div class="result-title">What You're Looking For</div>
                <div id="connectionType"></div>
            </div>
            
            <div class="result-card">
                <div class="result-title">Your Interaction Style</div>
                <div id="interactionStyle"></div>
            </div>
            
            <div class="result-card">
                <div class="result-title">Location & Logistics</div>
                <div id="locationPreference"></div>
            </div>
            
            <div class="result-card">
                <div class="result-title">Commitment Level</div>
                <div id="commitmentLevel"></div>
            </div>
            
            <div class="result-card">
                <div class="result-title">Relationship Summary</div>
                <div id="summary"></div>
            </div>
            
            <div id="aiInsightContainer" style="display: none;">
                <div class="loading" id="aiLoading">
                    <div class="spinner"></div>
                    <p>Generating personalized insights...</p>
                </div>
                
                <div class="ai-insight" id="aiInsight" style="display: none;">
                    <div class="ai-badge">AI Insight</div>
                    <div id="aiInsightContent"></div>
                </div>
            </div>
            
            <div id="shareContainer" style="display: none;">
                <div class="share-options">
                    <h3>Share Your Results</h3>
                    
                    <div style="width: 100%;">
                        <input type="text" id="shareUrl" readonly />
                        <button class="copy-btn" id="copyBtn">
                            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                <rect x="9" y="9" width="13" height="13" rx="2" ry="2"></rect>
                                <path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"></path>
                            </svg>
                            Copy Link
                        </button>
                    </div>
                    
                    <div class="loading" id="imageLoading">
                        <div class="spinner"></div>
                        <p>Generating shareable image...</p>
                    </div>
                    
                    <img id="shareImage" class="share-image" style="display: none;" />
                    
                    <a id="downloadBtn" download="my-relationship-preferences.jpg" style="display: none;" class="share-link">
                        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
                            <polyline points="7 10 12 15 17 10"></polyline>
                            <line x1="12" y1="15" x2="12" y2="3"></line>
                        </svg>
                        Download Image
                    </a>
                </div>
            </div>
            
            <button class="restart-btn" id="restartBtn">Start Over</button>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const startBtn = document.getElementById('startBtn');
            const prevBtn = document.getElementById('prevBtn');
            const nextBtn = document.getElementById('nextBtn');
            const restartBtn = document.getElementById('restartBtn');
            const intro = document.getElementById('intro');
            const quiz = document.getElementById('quiz');
            const results = document.getElementById('results');
            const progress = document.getElementById('progress');
            const aiInsightContainer = document.getElementById('aiInsightContainer');
            const aiInsight = document.getElementById('aiInsight');
            const aiInsightContent = document.getElementById('aiInsightContent');
            const aiLoading = document.getElementById('aiLoading');
            const shareContainer = document.getElementById('shareContainer');
            const shareUrl = document.getElementById('shareUrl');
            const copyBtn = document.getElementById('copyBtn');
            const shareImage = document.getElementById('shareImage');
            const downloadBtn = document.getElementById('downloadBtn');
            const imageLoading = document.getElementById('imageLoading');
            
            let currentQuestion = 1;
            const totalQuestions = 8;
            const answers = {};
            
            // Check URL parameters for shared results
            function loadFromParams() {
                const params = new URLSearchParams(window.location.search);
                let hasParams = false;
                
                for (const [key, value] of params.entries()) {
                    if (key.startsWith('q') && !isNaN(key.substring(1))) {
                        const questionNum = parseInt(key.substring(1));
                        answers[questionNum] = value;
                        hasParams = true;
                    }
                }
                
                if (hasParams) {
                    // Skip the quiz and show results directly
                    intro.style.display = 'none';
                    quiz.style.display = 'none';
                    results.style.display = 'block';
                    analyzeResults();
                    generateAIInsight();
                    generateShareableContent();
                }
            }
            
            // Call on load
            loadFromParams();
            
            // Start the quiz
            startBtn.addEventListener('click', function() {
                intro.style.display = 'none';
                quiz.style.display = 'block';
                updateProgressBar();
            });
            
            // Handle option selection
            document.querySelectorAll('.option').forEach(option => {
                option.addEventListener('click', function() {
                    // Remove selected class from siblings
                    const siblings = this.parentElement.querySelectorAll('.option');
                    siblings.forEach(sib => sib.classList.remove('selected'));
                    
                    // Add selected class to clicked option
                    this.classList.add('selected');
                    
                    // Store the answer
                    answers[currentQuestion] = this.getAttribute('data-value');
                    
                    // Enable next button
                    nextBtn.disabled = false;
                });
            });
            
            // Next button handler
            nextBtn.addEventListener('click', function() {
                // If option not selected, prevent going next
                if (!answers[currentQuestion]) {
                    return;
                }
                
                // Hide current question
                document.getElementById('question' + currentQuestion).classList.remove('active');
                
                // If last question, show results
                if (currentQuestion === totalQuestions) {
                    showResults();
                    return;
                }
                
                // Show next question
                currentQuestion++;
                document.getElementById('question' + currentQuestion).classList.add('active');
                
                // Update buttons and progress
                updateButtonsState();
                updateProgressBar();
                
                // Disable next button until selection
                if (!answers[currentQuestion]) {
                    nextBtn.disabled = true;
                }
            });
            
            // Previous button handler
            prevBtn.addEventListener('click', function() {
                // Hide current question
                document.getElementById('question' + currentQuestion).classList.remove('active');
                
                // Show previous question
                currentQuestion--;
                document.getElementById('question' + currentQuestion).classList.add('active');
                
                // Update buttons and progress
                updateButtonsState();
                updateProgressBar();
                
                // Enable next button
                nextBtn.disabled = false;
            });
            
            // Restart button handler
			restartBtn.addEventListener('click', function() {
				// Reset everything
				currentQuestionIndex = 0;
				Object.keys(answers).forEach(key => delete answers[key]);
				
				// Clear selected options
				document.querySelectorAll('.option').forEach(option => {
					option.classList.remove('selected');
				});
				
				// Show first question
				results.style.display = 'none';
				intro.style.display = 'block';
				quiz.style.display = 'none';
				
				document.querySelectorAll('.question-container').forEach(container => {
					container.classList.remove('active');
				});
				document.getElementById('question' + questionOrder[0]).classList.add('active');
				
				// Reset buttons and progress
				updateButtonsState();
				updateProgressBar();
				
				// Hide AI insights and share container
				aiInsightContainer.style.display = 'none';
				shareContainer.style.display = 'none';
				
				// Clear URL parameters by replacing current URL with base URL
				const baseUrl = window.location.href.split('?')[0];
				window.history.replaceState({}, document.title, baseUrl);
			});
            
            // Copy share URL button handler
            copyBtn.addEventListener('click', function() {
                shareUrl.select();
                document.execCommand('copy');
                copyBtn.textContent = 'Copied!';
                setTimeout(() => {
                    copyBtn.innerHTML = '<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="9" y="9" width="13" height="13" rx="2" ry="2"></rect><path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"></path></svg> Copy Link';
                }, 2000);
            });
            
            function updateButtonsState() {
                prevBtn.style.visibility = currentQuestion === 1 ? 'hidden' : 'visible';
                nextBtn.textContent = currentQuestion === totalQuestions ? 'See Results' : 'Next';
            }
            
            function updateProgressBar() {
                const percentage = ((currentQuestion - 1) / totalQuestions) * 100;
                progress.style.width = percentage + '%';
            }
            
            function showResults() {
                quiz.style.display = 'none';
                results.style.display = 'block';
                
                // Analyze the answers and display results
                analyzeResults();
                
                // Generate AI insights
                generateAIInsight();
                
                // Generate shareable content
                generateShareableContent();
            }
            
			function analyzeResults() {
				// Gender and Orientation
				const genderIdentity = answers['0a'] || '';
				const genderPreference = answers['0b'] || '';
			
                // Connection Type
                const connectionEl = document.getElementById('connectionType');
                switch(answers[1]) {
                    case 'friendship':
                        connectionEl.innerHTML = 'You value <strong>genuine friendship and connection</strong> above all. You are looking for someone you can trust and share meaningful experiences with, where the foundation is a strong friendship.';
                        break;
                    case 'casual':
                        connectionEl.innerHTML = 'You are seeking <strong>fun, light-hearted interactions</strong> without too much pressure or intensity. You enjoy connecting with people who bring positive energy and enjoyment to your life.';
                        break;
                    case 'romantic':
                        connectionEl.innerHTML = 'You prioritize <strong>deep emotional intimacy</strong> in your connections. You are looking for someone you can truly open up to and share your inner world with.';
                        break;
                    case 'physical':
                        connectionEl.innerHTML = 'You place high importance on <strong>physical chemistry and attraction</strong>. While other aspects matter, you recognize that this spark is essential for your satisfaction in a relationship.';
                        break;
                }
                
                // Interaction Style
                const interactionEl = document.getElementById('interactionStyle');
                let interactionText = '';
                
                // Combine questions 2 (how to spend time) and 3 (flirting level)
                if (answers[2] === 'virtual') {
                    interactionText += 'You prefer primarily <strong>virtual interactions</strong> through texts, calls, and video chats. ';
                } else if (answers[2] === 'casual-meetups') {
                    interactionText += 'You enjoy <strong>casual hangouts</strong> without too much pressure or planning. ';
                } else if (answers[2] === 'planned-dates') {
                    interactionText += 'You value <strong>intentional, planned dates</strong> that show thought and care. ';
                } else if (answers[2] === 'travel') {
                    interactionText += 'You are drawn to <strong>traveling and experiencing new places</strong> with someone special. ';
                }
                
                if (answers[3] === 'none') {
                    interactionText += 'When it comes to romantic gestures, you <strong>prefer to keep things platonic</strong> with minimal to no flirting.';
                } else if (answers[3] === 'light') {
                    interactionText += 'Your flirting style tends to be <strong>light and playful</strong> without serious intentions.';
                } else if (answers[3] === 'moderate') {
                    interactionText += 'You enjoy <strong>moderate flirting</strong> with some romantic gestures that show interest and affection.';
                } else if (answers[3] === 'intense') {
                    interactionText += 'You thrive on <strong>intense romantic and passionate interactions</strong> with someone you are interested in.';
                }
                
                interactionEl.innerHTML = interactionText;
                
                // Location Preference
                const locationEl = document.getElementById('locationPreference');
                let locationText = '';
                
                // Combine questions 4 (proximity) and 6 (pace)
                if (answers[4] === 'local') {
                    locationText += 'You strongly prefer <strong>local connections</strong> with regular in-person interaction. ';
                } else if (answers[4] === 'driving') {
                    locationText += 'You are comfortable with someone <strong>within driving distance</strong>, allowing for regular but not daily meetings. ';
                } else if (answers[4] === 'long-distance') {
                    locationText += 'You are <strong>open to long-distance relationships</strong> with occasional visits. ';
                } else if (answers[4] === 'anywhere') {
                    locationText += '<strong>Location is not a significant factor</strong> for you when connecting with someone. ';
                }
                
                if (answers[6] === 'slow') {
                    locationText += 'You prefer relationships to develop <strong>slowly and gradually</strong>, giving you time to build trust.';
                } else if (answers[6] === 'moderate') {
                    locationText += 'You like relationships to progress at a <strong>moderate, natural pace</strong> without feeling rushed or stalled.';
                } else if (answers[6] === 'fast') {
                    locationText += 'When there is chemistry, you are comfortable with things moving <strong>relatively quickly</strong>.';
                } else if (answers[6] === 'varies') {
                    locationText += 'Your preferred pace <strong>varies depending on the connection</strong> and specific circumstances.';
                }
                
                locationEl.innerHTML = locationText;
                
                // Commitment Level
                const commitmentEl = document.getElementById('commitmentLevel');
                let commitmentText = '';
                
                // Combine questions 5 (exclusivity) and 8 (integration)
                if (answers[5] === 'open') {
                    commitmentText += 'You prefer <strong>complete openness</strong> and the freedom to see other people. ';
                } else if (answers[5] === 'casual') {
                    commitmentText += 'You are looking for something <strong>casual but respectful</strong>, without the need for labels. ';
                } else if (answers[5] === 'exclusive-casual') {
                    commitmentText += 'You value <strong>exclusivity</strong> while still keeping the relationship relatively light. ';
                } else if (answers[5] === 'committed') {
                    commitmentText += 'You are seeking a <strong>dedicated, committed relationship</strong> with clear boundaries. ';
                }
                
                if (answers[8] === 'separate') {
                    commitmentText += 'You prefer to <strong>keep your relationship separate</strong> from other aspects of your life.';
                } else if (answers[8] === 'casual-integration') {
                    commitmentText += 'You are comfortable with <strong>some casual integration</strong> of your relationship into your regular life.';
                } else if (answers[8] === 'significant') {
                    commitmentText += 'You want <strong>significant integration</strong> of your partner into your social circle and daily life.';
                } else if (answers[8] === 'complete') {
                    commitmentText += 'You desire <strong>complete integration</strong> of your relationship into all aspects of your life.';
                }
                
                commitmentEl.innerHTML = commitmentText;
                
                // Generate Overall Summary
                const summaryEl = document.getElementById('summary');
                let relationshipType = determineRelationshipType();
                let physicalityLevel = determinePhysicalityLevel();
                
                summaryEl.innerHTML = "Based on your responses, you seem most aligned with a <strong>" + relationshipType + "</strong> where " + physicalityLevel + ". When meeting someone new, being clear about these preferences can help you find a more compatible connection and avoid mismatched expectations.";
            }
            
			function determineRelationshipType() {
				// This is a simplified analysis based on key questions
				const connection = answers[1];
				const exclusivity = answers[5];
				const physicality = answers[7];
				const relationshipStructure = answers['5a'];
				
				// Include relationship structure in the analysis if provided
				if (relationshipStructure === 'polyamorous') {
					return "polyamorous relationship dynamic";
				} else if (relationshipStructure === 'open') {
					return "open relationship with a primary connection";
				} else if (relationshipStructure === 'relationship-anarchy') {
					return "relationship anarchy approach";
				}
				
				// Original logic
				if (connection === 'friendship' && physicality === 'not-important') {
					return "platonic friendship";
				} else if (connection === 'friendship' && physicality === 'essential') {
					return "friends-with-benefits arrangement";
				} else if (connection === 'casual' && exclusivity === 'open') {
					return "casual, no-strings-attached connection";
				} else if (connection === 'physical' && (exclusivity === 'open' || exclusivity === 'casual')) {
					return "physical-focused casual relationship";
				} else if (connection === 'romantic' && exclusivity === 'committed') {
					return "committed, emotionally intimate relationship";
				} else if (exclusivity === 'committed' || exclusivity === 'exclusive-casual') {
					return "exclusive relationship";
				} else {
					return "balanced relationship with elements of friendship and romance";
				}
			}
            
            function determinePhysicalityLevel() {
                const physicality = answers[7];
                
                if (physicality === 'not-important') {
                    return "physical intimacy is not a priority";
                } else if (physicality === 'somewhat') {
                    return "physical aspects are present but not central to the connection";
                } else if (physicality === 'important') {
                    return "physical and emotional compatibility are equally important";
                } else if (physicality === 'essential') {
                    return "physical chemistry plays a central role";
                } else {
                    return "the balance of emotional and physical connection is flexible";
                }
            }
            
            // Generate shareable URL with parameters
            function generateShareableLink() {
                const params = new URLSearchParams();
                Object.entries(answers).forEach(([question, answer]) => {
                    params.set(`q${question}`, answer);
                });
                
                const shareableUrl = `${window.location.origin}${window.location.pathname}?${params.toString()}`;
                return shareableUrl;
            }
            
            // Generate AI insights using Pollinations.ai API
            async function generateAIInsight() {
                aiInsightContainer.style.display = 'block';
                aiLoading.style.display = 'flex';
                aiInsight.style.display = 'none';
                
                // Prepare the context for the AI
                const relationshipType = determineRelationshipType();
                const physicality = determinePhysicalityLevel();
                const connectionPref = answers[1] || '';
                const interactionPref = answers[2] || '';
                const flirtingPref = answers[3] || '';
                const locationPref = answers[4] || '';
                const exclusivityPref = answers[5] || '';
                const pacePref = answers[6] || '';
                const physicalPref = answers[7] || '';
                const integrationPref = answers[8] || '';
                
				const prompt = `Based on these relationship preferences:
				- Connection priority: ${connectionPref}
				- Interaction preference: ${interactionPref}
				- Flirting style: ${flirtingPref}
				- Location preference: ${locationPref}
				- Exclusivity preference: ${exclusivityPref}
				- Relationship pace: ${pacePref}
				- Physical intimacy importance: ${physicalPref}
				- Life integration: ${integrationPref}
				- Overall relationship type: ${relationshipType}
				- Physical intimacy level: ${physicality}

				Provide a direct analysis of these relationship preferences. Include: 1) A brief summary of the overall preference pattern, 2) Two strengths of this approach to relationships, 3) Two potential challenges this person might face, and 4) One specific tip for finding compatible partners. Do not ask questions or use conversational phrases.`;
                
				const system = "You are a relationship preferences analyst. Provide a clear, direct analysis of the relationship preferences based on the quiz answers. Focus on analyzing the preference pattern itself rather than referring to 'this person' or using 'you'. Simply describe: 1) The relationship pattern shown by these preferences, 2) Strengths of this approach, 3) Potential challenges that could arise, and 4) Compatibility factors worth considering. Keep your analysis objective, informative, and focused solely on the pattern of preferences shown in the data.";
                
                try {
                    // Use Pollinations.ai text generation API with OpenAI model
                    const encodedPrompt = encodeURIComponent(prompt);
                    const encodedSystem = encodeURIComponent(system);
                    const url = `https://text.pollinations.ai/prompt?prompt=${encodedPrompt}&model=openai&system=${encodedSystem}`;
                    
                    const response = await fetch(url);
                    if (!response.ok) {
                        throw new Error('API request failed');
                    }
                    
                    const insight = await response.text();
                    
                    // Display the insight
                    aiInsightContent.innerHTML = insight.trim();
                    aiLoading.style.display = 'none';
                    aiInsight.style.display = 'block';
                } catch (error) {
                    console.error('Error generating AI insight:', error);
                    aiInsightContent.innerHTML = "Sorry, we couldn't generate personalized insights at this time. Your relationship preferences are still valid and valuable for your self-understanding.";
                    aiLoading.style.display = 'none';
                    aiInsight.style.display = 'block';
                }
            }
            
			// Generate dynamic image prompt using the text.pollinations.ai API first
			async function generateImagePrompt() {
				const relationshipType = determineRelationshipType();
				const physicality = determinePhysicalityLevel();
				const connectionPref = answers[1] || '';
				const interactionPref = answers[2] || '';
				const flirtingPref = answers[3] || '';
				const locationPref = answers[4] || '';
				const exclusivityPref = answers[5] || '';
				
				// Create a prompt for the text AI to generate a unique image prompt
				const promptForImageGen = `Based on these relationship preferences:
				- Connection priority: ${connectionPref}
				- Interaction preference: ${interactionPref}
				- Flirting style: ${flirtingPref}
				- Location preference: ${locationPref}
				- Exclusivity preference: ${exclusivityPref}
				- Overall relationship type: ${relationshipType}
				- Physical intimacy level: ${physicality}
				
				Create a detailed, unique image prompt (about 30-40 words) for an AI image generator that visually represents these specific relationship preferences. The image should be photographic in style, include a setting that matches the interaction preferences, and convey the emotional tone of this relationship type. Do NOT include any text elements in the image. Include some purple tones in the color palette. Make it highly specific to these exact preferences, not generic. Return ONLY the image prompt text with no explanations.`;
				
				const system = "You are an expert prompt engineer for AI image generation. Create highly specific, detailed prompts that will generate images perfectly matched to the relationship preferences provided. Never explain your prompts, just provide the image prompt text directly. Focus on visual elements, atmosphere, color, and composition that represent the emotional quality of the relationship type. Always make prompts unique and tailored to the specific details provided.";
				
				try {
					// Use Pollinations.ai text generation API with OpenAI model
					const encodedPrompt = encodeURIComponent(promptForImageGen);
					const encodedSystem = encodeURIComponent(system);
					const url = `https://text.pollinations.ai/prompt?prompt=${encodedPrompt}&model=openai&system=${encodedSystem}`;
					
					const response = await fetch(url);
					if (!response.ok) {
						throw new Error('API request failed');
					}
					
					let imagePrompt = await response.text();
					imagePrompt = imagePrompt.trim();
					
					// Ensure the prompt is appropriate length and add fallback if needed
					if (imagePrompt.length < 10) {
						imagePrompt = `A couple with ${relationshipType} dynamic, atmospheric lighting, purple tones, professional photography, emotional connection, high quality`;
					}
					
					return imagePrompt;
				} catch (error) {
					console.error('Error generating image prompt:', error);
					return `A couple representing ${relationshipType}, atmospheric lighting, purple tones, professional photography`;
				}
			}

			// Update the generateShareableContent function to use this dynamic prompt
			async function generateShareableContent() {
				shareContainer.style.display = 'block';
				
				// Generate and display shareable URL
				const shareLink = generateShareableLink();
				shareUrl.value = shareLink;
				
				// Show loading for image generation
				imageLoading.style.display = 'flex';
				shareImage.style.display = 'none';
				downloadBtn.style.display = 'none';
				
				try {
					// First generate a custom image prompt using AI
					const imagePrompt = await generateImagePrompt();
					console.log("Generated image prompt:", imagePrompt);
					
					// Then use that prompt with the image API
					const imageUrl = `https://image.pollinations.ai/prompt/${encodeURIComponent(imagePrompt)}?width=800&height=600&nologo=true&model=flux`;
					
					// Set image source
					shareImage.src = imageUrl;
					shareImage.onload = function() {
						imageLoading.style.display = 'none';
						shareImage.style.display = 'block';
						downloadBtn.href = imageUrl;
						downloadBtn.style.display = 'block';
					};
					shareImage.onerror = function() {
						handleImageError();
					};
				} catch (error) {
					console.error('Error in image generation process:', error);
					handleImageError();
				}
			}

			function handleImageError() {
				imageLoading.style.display = 'none';
				const errorMsg = document.createElement('p');
				errorMsg.textContent = "Couldn't generate image. You can still share your results using the link above.";
				errorMsg.style.color = "#ff6b6b";
				imageLoading.parentNode.insertBefore(errorMsg, imageLoading.nextSibling);
			}
        });
    </script>
</body>
</html>