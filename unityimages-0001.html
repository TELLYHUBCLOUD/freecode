import React, { useState } from 'react';
import { Send } from 'lucide-react';

const ImageGenerator = () => {
  const [userPrompt, setUserPrompt] = useState('');
  const [imageUrl, setImageUrl] = useState('/api/placeholder/600/600');
  const [isLoading, setIsLoading] = useState(false);

  const MAIN_STYLE = `Mobile Photography style, spontaneous, convenient, real-time editing, social media-driven, lowbrow art, pop culture, surreal, vibrant colors, highly detailed, grunge, gritty, dark, textured, realism, lifelike, detailed, accurate, everyday scenes, muted colors, traditional, natural colors, cluttered scenes depicting candid real life that is not arranged and is caught in the moment`;

  const handleSubmit = async (e) => {
    e.preventDefault();
    if (!userPrompt.trim()) return;
    
    setIsLoading(true);
    const seed = Math.floor(Math.random() * 1000000);
    const messages = [
      {
        role: "system",
        content: `You are an AI image generation assistant. Your task is to combine user prompts with a specific photography style while ensuring the user's prompt doesn't conflict with the intended style. Main style: ${MAIN_STYLE}`
      },
      {
        role: "user",
        content: userPrompt
      }
    ];

    try {
      const response = await fetch(`https://text.pollinations.ai/prompt/${encodeURIComponent(userPrompt)}?model=flux&enhance=false&width=600&height=600&seed=${seed}&jsonMode=false`, {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json',
        },
        body: JSON.stringify({ messages })
      });

      if (response.ok) {
        const imageBlob = await response.blob();
        const imageUrl = URL.createObjectURL(imageBlob);
        setImageUrl(imageUrl);
      }
    } catch (error) {
      console.error('Error generating image:', error);
    } finally {
      setIsLoading(false);
    }
  };

  const handleKeyPress = (e) => {
    if (e.key === 'Enter' && !e.shiftKey) {
      handleSubmit(e);
    }
  };

  return (
    <div className="flex flex-col items-center min-h-screen bg-gray-900 pt-32">
      <div className="w-[600px] h-[600px] bg-gray-800 rounded-lg overflow-hidden">
        {isLoading ? (
          <div className="w-full h-full flex items-center justify-center">
            <div className="animate-spin rounded-full h-32 w-32 border-b-2 border-white"></div>
          </div>
        ) : (
          <img
            src={imageUrl}
            alt="Generated artwork"
            className="w-full h-full object-cover"
          />
        )}
      </div>
      
      <div className="mt-8 w-[600px]">
        <form onSubmit={handleSubmit} className="flex gap-2">
          <input
            type="text"
            value={userPrompt}
            onChange={(e) => setUserPrompt(e.target.value)}
            onKeyPress={handleKeyPress}
            placeholder="Enter your prompt..."
            className="flex-1 px-4 py-2 rounded-lg bg-gray-800 text-white border border-gray-700 focus:outline-none focus:border-blue-500"
          />
          <button
            type="submit"
            className="px-6 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 focus:outline-none flex items-center gap-2"
            disabled={isLoading}
          >
            <Send size={20} />
            Send
          </button>
        </form>
      </div>
    </div>
  );
};

export default ImageGenerator;